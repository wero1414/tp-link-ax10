!function(c){c.su.moduleManager.define("login",{deps:["main"],services:["moduleLoader","ajax","device","moduleManager","language"],stores:["loginLanguageStore"],models:["firmwareModel","loginLanguage"],views:["loginView"],listeners:{ev_on_launch:function(e,o,i,n,t,a,r){localStorage.setItem("userInfo",""),sessionStorage.removeItem("cloudMsgToken"),c.su.scrollbar({ele:".login-view"});var o=this,l=r.device.getLocale(),t=(r.device.getForce()?(o.lang=l,i.loginView.switchLanBtn.setText(c.su.CHAR.LANGUAGE[l.toUpperCase()]),n.loginLanguage.language.disable()):t.loginLanguageStore.load({success:function(){o.lang=l,n.loginLanguage.language.setValue(l),i.loginView.switchLanBtn.setText(c.su.CHAR.LANGUAGE[l.toUpperCase()])}}),n.firmwareModel.load({success:function(){var e=n.firmwareModel.getData().hardwareVersion;r.device.getConfig().supportFirmwareInfoReplace&&(e=e.replace("v1.0","v1.0/v1.20")),i.loginView.hardwareVersion.setValue(e)}}),r.device.getProductName());document.title=t,i.loginView.productName.setValue(t),i.loginView.currentOperation.setValue(t),r.ajax.request({proxy:"firstTimeProxy",method:"read",success:function(e){c.encrypt.encryptManager.cleanStorage(),c.su.encryptor=c.encrypt.encryptManager.genEncryptor();1==e.is_default?(o.goToChildModule("initLogin"),o.firmwareDefault=!0):(e.cloud_ever_login,o.goToChildModule("localLogin"),o.firmwareDefault=!1)}}),r.ajax.request({url:c.su.url("/domain_login?form=dlogin"),data:{operation:"read"},success:function(e){var n=e;if(n&&!0===n.conflict)switch(n.mode){case 0:i.loginView.situation0.show(),i.loginView.situation1.hide(),i.loginView.ipConflict0.setText(c.su.CHAR.INIT.IMPORTANT_UPDATE_INFO+" "+n.new_addr+c.su.CHAR.INIT.END);break;case 1:i.loginView.situation0.hide(),i.loginView.situation1.show(),i.loginView.ipConflict1.setText(c.su.CHAR.INIT.IMPORTANT_UPDATE_INFO+" "+n.new_addr+" "+c.su.CHAR.INIT.OR+" "+n.dst_addr+c.su.CHAR.INIT.END2),o.dstAddress="//"+n.dst_addr+n.dst_webpath,i.loginView.dstBtn.setText(n.dst_addr),i.loginView.newBtn.setText(n.new_addr)}n&&n.redirect&&(location.href=n.redirect)}})}},init:function(o,e,n,i,t,a){this.control({"#ip-conflict-confirm-btn":{ev_button_click:function(){e.loginView.situation0.hide()}},"#ip-conflict-situation-1-dst":{ev_button_click:function(){window.location.href=o.dstAddress}},"#ip-conflict-situation-1-new":{ev_button_click:function(){e.loginView.situation1.hide()}},".qs-lan-cb":{mouseenter:function(){c(".login-lan-button").addClass("hover")},mouseleave:function(){c(".login-lan-button").removeClass("hover")},ev_view_change:function(e,n){n.value!==o.lang&&a.language.switchTo(n.value)}}})}},function(n,i,e,o,t,a){return{dstAddress:"",setSecondContainerTitle:function(e){i.loginView.currentOperation.setValue(e)},goToChildModule:(l=function(e){return i.loginView[e+"Loader"]},u=[],s={initLogin:{container:"mainContainer",reLaunchWhenShow:!0},localLogin:{container:"mainContainer",reLaunchWhenShow:!0},tpLogin:{container:"mainContainer",reLaunchWhenShow:!0},tpSignUp:{container:"secondaryContainer",reLaunchWhenShow:!0},localPwdRecovery:{container:"secondaryContainer",reLaunchWhenShow:!0},tpCloud:{container:"secondaryContainer",reLaunchWhenShow:!0}},function(e,n){r&&l(r).hide(),"mainContainer"===s[e].container?(i.loginView.secondaryContainer.hide(),i.loginView.mainContainer.show()):"secondaryContainer"===s[e].container&&(i.loginView.mainContainer.hide(),i.loginView.secondaryContainer.show());var o=l(e);o.show(),0<=c.inArray(e,u)||("tpCloud"==e&&a.moduleManager.get("tpLogin").unLoad(),a.moduleLoader.load({module:"login",view:"loginView"},{module:e,view:"tpLogin"===e?"tpLoginView":null},o,n),s[e].reLaunchWhenShow)||u.push(e),r=e}),supportCloud:function(){return!0},CHECK_INTERNET_URL:c.su.url("/login?form=check_internet"),hasInternet:function(){var e=c.Deferred();return a.ajax.request({url:n.CHECK_INTERNET_URL,success:function(){e.resolve(!0)},fail:function(){e.resolve(!1)},error:function(){e.resolve(!1)}}),e.promise()},unLoad:function(){a.moduleLoader.unLoad(i.loginView.tpCloudLoader)}};var r,l,u,s})}(jQuery);