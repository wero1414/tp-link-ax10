!function(s){s.su.moduleManager.define("main",{services:["moduleLoader","user","ajax","device"],stores:[],deps:[],views:["main"],listeners:{ev_on_launch:function(o,a,e,n,t,i,r){location.hash&&location.hash.substr(1),a.syncTokenFromStorage(),s("#global-splash .outer").css("background-size","cover"),setTimeout(function(){a.hideSplash()},600);if(r.device.getIsBeta()?s("body").addClass("beta"):s("body").removeClass("beta"),""===a.getToken())a.loadBasicModule("login");else{try{s.su.encryptor=s.encrypt.encryptManager.getEncryptor(),s.su.userInfo=localStorage.getItem("userInfo")?JSON.parse(s.su.DES3.decrypt(localStorage.getItem("userInfo"))):{}}catch(o){return void a.loadLoginPage()}r.ajax.request({proxy:"firmwareProxy",method:"read",success:function(o){var e="ap"===r.device.getCurrentMode()?"quickSetupAp":"quickSetup",n=(a.upgraded=o.upgraded,a.rebootTime=1e3*o.rebootTime,function(o){a.loadBasicModule("index",a.resetUpgradedValue)});location.hash.substr(1)===e||!0===o.isDefault?(location.href.indexOf(e)<0&&(location.href=location.href+"#"+e),a.loadBasicModule(e)):a.upgraded?r.ajax.request({proxy:"checkInternetProxy",success:function(o){r.ajax.request({proxy:"cloudBindStatusProxy",method:"read",success:function(o){o.isbind?n():a.loadBasicModule(e)},fail:n,error:n})},fail:n,error:n}):n()},fail:function(){a.loadBasicModule("login")},error:function(){a.loadBasicModule("login")}}),a.cloudInfo={},s.su.userInfo.token&&(a.cloudInfo.islogined=!0,a.cloudInfo.username=s.su.userInfo.username),r.ajax.request({proxy:"checkUpgradeNumberProxy",method:"read",success:function(o){o=parseInt(o.updateNumber,10);a.showUpgradeHint=0<o}}),a.checkMeshUpdate()}},ev_login_timeout:function(){this.onLoginTimeout()},ev_auto_upgrading:function(){this.onAutoUpgrading()},ev_user_conflict:function(){this.onUserConflict()},ev_permission_denied:function(){this.onPermissionDenied()}},init:function(n,o,e,a,t,i){this.control({"#global-confirm":{ev_msg_ok:function(o,e){n.globalConfirmSuccessCallback&&n.globalConfirmSuccessCallback.call(null,e),n.globalConfirmSuccessCallback=null},ev_msg_no:function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null},ev_msg_close:function(){n.globalConfirmFailCallback&&n.globalConfirmFailCallback.call(),n.globalConfirmFailCallback=null}},"#failure-retry-msg":{ev_msg_ok:function(){s.su.moduleManager.get("firmware").failureRetry()}},"#upgrade-fail-alert":{ev_msg_ok:function(){var o=s.su.moduleManager.get("qsInternetConnection");o&&o.proceedTpCloud()}}})}},function(i,r,o,e,n,a){i=this;return{LOGOUT_URL:s.su.url("/admin/system?form=logout"),FIRMWARE_URL:s.su.url("/admin/firmware?form=upgrade"),waitingId:!1,waitingTime:2e4,showUpgradeHint:!1,upgraded:!1,rebootTime:12e4,loadBasicModule:function(o,e){a.moduleLoader.load({module:"main"},{module:o},r.main.basicModuleLoader,e)},resetUpgradedValue:function(){a.ajax.request({proxy:"firmwareProxy",method:"write",data:{upgraded:!1}}),i.upgraded=!1},splashTime:1e3,showSplash:function(){r.main.splash.show()},hideSplash:function(){r.main.splash.fadeOut(400)},showError:function(o){o&&(r.main.globalError.setContent(o),r.main.globalError.show())},startReboot:function(o,e,n){o=o||9e4;var a=this;n?(r.main.rebootTips.show(),r.main.rebootTips.setText(n)):r.main.rebootTips.hide(),r.main.rebootMsg.show(function(){r.main.rebootProgress.animate({duration:o,percentageStart:0,percentageEnd:100,callback:function(){a.checkReboot(),e&&e()}})})},checkReboot:function(){r.main.rebootMsg.hide()},checkMeshUpdate:function(){a.ajax.request({proxy:"meshRouterUpdateProxy",success:function(o){s.grep(o,function(o){return!o.is_latest}).length&&(i.showUpgradeHint=!0)}})},showNotice:function(o,e){r.main.globalNotice.show(o,e)},hideNotice:function(o){r.main.globalNotice.hide(o)},checkLogin:function(){},setToken:function(o){localStorage.setItem("token",o),s.su.url.stok=o},getToken:function(){var o=s.su.url.stok;return o||""},syncTokenFromStorage:function(){var o=localStorage.getItem("token");o&&(s.su.url.stok=o)},onLoginTimeout:function(){i.setToken(""),location.href="http://tplinkwifi.net"},onAutoUpgrading:function(){i.setToken(""),location.href="./auto_update_blocking.html"},loadLoginPage:function(){i.setToken(""),i.loadBasicModule("login")},onUserConflict:function(){},onPermissionDenied:function(){i.alert(s.su.CHAR.ERROR["00000088"])},reload:function(){location.href="/"},toggelVisibleMask:function(o){o?r.main.transparentMask.show("global-nontrans-mask"):r.main.transparentMask.hide("global-nontrans-mask")},showMask:function(){r.main.transparentMask.show("global-trans-mask")},hideMask:function(){r.main.transparentMask.hide("global-trans-mask")},confirm:function(o,e,n,a,t){o&&(r.main.globalConfirm.setContent(o),r.main.globalConfirm.show(),r.main.globalConfirm.setButtonText("ok",a||s.su.CHAR.OPERATION.YES_UPPERCASE),r.main.globalConfirm.setButtonText("no",t||s.su.CHAR.OPERATION.CANCEL_UPPERCASE),i.globalConfirmSuccessCallback=e||function(){},i.globalConfirmFailCallback=n||function(){})},alert:function(o){o&&(r.main.globalAlert.setContent(o),r.main.globalAlert.show())},getCloudInfo:function(){return i.cloudInfo},setWaitingEvent:function(o,e,n){i.waitingId=!1;n=n||i.waitingTime;return e=(e=e||window).jquery?e:s(e),i.waitingId=setTimeout(function(){e.trigger(o)},n),!0},clearWaitingEvent:function(){i.waitingId&&(clearTimeout(i.waitingId),i.waitingId=!1)},showProBar:function(o,e){r.main.proBar.reset(),r.main.proBar.setText(o),e?(r.main.proBarTips.show(),r.main.proBarTips.setText(e)):r.main.proBarTips.hide(),r.main.progressbarWrap.show()},hideProBar:function(){r.main.progressbarWrap.hide()},setProBarValue:function(o,e){r.main.proBar.setValue(o,e)},setProBarAnimate:function(o,e){r.main.proBar.animate({percentageStart:0,percentageEnd:100,duration:1e3*o,callback:e})},setUpgradeRetryContent:function(o){r.main.failRetryMsg.setContent(o)},showUpgradeRetry:function(){r.main.failRetryMsg.show()},showUpgradeFailAlert:function(){r.main.upgradeFailAlert.show()}}})}(jQuery);