!function(l){l.su.moduleManager.define("led",{models:["ledControlModel","nightModeModel","meshEnableModel"],stores:["meshSatellitesStore"],services:["time","timer","device"],views:["ledView"],listeners:{ev_on_launch:function(e,t,o,n,i,s,d){this.unRegisterAutoSaveData([n.ledControlModel]),this.startCheckLed(!0),n.nightModeModel.load(),t.configMeshNoteDisplay()},ev_before_destroy:function(e,t){t.beforeDestroy()}},init:function(n,i,s,e,t,d){this.configViews({}),this.listen({"models.nightModeModel.enable":{ev_value_change:function(e,t,o){"on"===t?(i.ledView.nightModeFieldset.show(),d.time.on("on_time_change",n.onTimeChange),d.time.on("on_hour24_change",n.onHour24Change)):(i.ledView.nightModeFieldset.hide(),d.time.off("on_time_change",n.onTimeChange),d.time.off("on_hour24_change",n.onHour24Change))}},"models.nightModeModel.timeStart":{ev_value_change:function(e,t,o){var t=t||"00:00",n=s.nightModeModel.timeEnd.getValue()||"00:00";"string"==typeof t&&"string"==typeof n&&(t=parseInt(t.replace(":",""),10),parseInt(n.replace(":",""),10)<=t?s.nightModeModel.timeEnd.setShortTips(l.su.CHAR.LED.NEXT_DAY_TIP):s.nightModeModel.timeEnd.setShortTips("&nbsp;"))}},"models.nightModeModel.timeEnd":{ev_value_change:function(e,t,o){var n=s.nightModeModel.timeStart.getValue()||"00:00",t=t||"00:00";"string"==typeof n&&"string"==typeof t&&(n=parseInt(n.replace(":",""),10),parseInt(t.replace(":",""),10)<=n?s.nightModeModel.timeEnd.setShortTips(l.su.CHAR.LED.NEXT_DAY_TIP):s.nightModeModel.timeEnd.setShortTips("&nbsp;"))}}}),this.control({"#led-enable":{ev_view_change:function(e,t){this.stopCheckLed(),s.ledControlModel.submit({success:function(){n.startCheckLed(!1)}})}}})}},function(e,n,o,t,i,s){var d=null;return{startCheckLed:function(e){d=s.timer.setInterval(this,function(){o.ledControlModel.load()},2900,e)},stopCheckLed:function(){s.timer.clearInterval(this,d),d=null},onTimeChange:function(e,t){var o=s.time.getHour24(),t=s.time.format(t,"yyyy-MM-dd HH:mm:ss",o);n.ledView.currentTime.setValue(t)},onHour24Change:function(e,t){t?(o.nightModeModel.timeEnd.setHourSystem("24"),o.nightModeModel.timeStart.setHourSystem("24")):(o.nightModeModel.timeEnd.setHourSystem("12"),o.nightModeModel.timeStart.setHourSystem("12"))},beforeDestroy:function(){s.time.off("on_time_change",e.onTimeChange),s.time.off("on_hour24_change",e.onHour24Change),this.stopCheckLed()},configMeshNoteDisplay:function(){"router"===s.device.getCurrentMode()&&l.when(l.su.Model.promiseLoad(o.meshEnableModel),l.su.Model.promiseLoad(t.meshSatellitesStore,{operation:"read"})).then(function(e,t){var e="on"==e.enable,t=0<t.length,o=n.ledView;e&&t?o.meshNote.show():o.meshNote.hide()})}}})}(jQuery);