!function(n){n.su.moduleManager.define("sysLog",{models:["sysLogModel","runningTimeModel","saveLogModel"],stores:["logTypeStore","frequencyStore","sysLogStore"],services:["ajax","time"],views:["sysLogView"],listeners:{ev_on_launch:function(e,s,o,a,i,t,l){this.unRegisterAutoSaveData([a.sysLogModel,a.saveLogModel]),"ios"===n.su.platform&&o.sysLogView.saveLocalBtn.hide(),i.sysLogStore.load(),i.logTypeStore.load(),a.sysLogModel.load(),a.saveLogModel.load(),l.time.on("on_time_change",s.onTimeChange)},ev_before_destroy:function(e,s){s.beforeDestroy()}},init:function(o,i,t,a,e,l){this.configViews({id:"sysLogView",items:[{id:"system-log-information",configs:{convert:function(e){var s=n.su.CHAR.SYSTEM_LOG[e.type],o=n.su.CHAR.SYSTEM_LOG[e.level];return s&&(e.type=s),o&&(e.level=o),[e.time,e.type,e.level,e.content].join(" ")}}}]}),this.listen({"models.sysLogModel.type":{ev_value_change:function(e,s,o){o&&o!==s&&this.filterLog(s)}},"models.saveLogModel":{ev_loaded:function(e,s){o.saveEmailFlag=!!s.to,o.saveEmailFlag&&i.sysLogView.autoMailField.show(),i.sysLogView.mailToLabel.setValue(s.to)}},"models.saveLogModel.autoMailType":{ev_value_change:function(e,s,o){var a=t.saveLogModel;"on"===a.autoMail.getValue()&&("day_time"===s?(a.everyDayTime.enable(),a.everyDayTime.show(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(a.everyHours.enable(),a.everyHours.show(),a.everyDayTime.disable(),a.everyDayTime.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND)))}},"models.saveLogModel.auth":{ev_value_change:function(e,s,o){"on"===s?(t.saveLogModel.username.enable(),t.saveLogModel.username.show(),t.saveLogModel.password.enable(),t.saveLogModel.password.show()):(t.saveLogModel.username.disable(),t.saveLogModel.username.hide(),t.saveLogModel.password.disable(),t.saveLogModel.password.hide())}},"models.saveLogModel.autoMail":{ev_value_change:function(e,s,o){var a=t.saveLogModel;"on"===s?(a.autoMailType.enable(),a.autoMailType.show(),"day_time"===a.autoMailType.getValue()?(a.everyDayTime.enable(),a.everyDayTime.show(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE)):(a.everyHours.enable(),a.everyHours.show(),a.everyDayTime.disable(),a.everyDayTime.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE_AND_SEND))):(a.autoMailType.disable(),a.autoMailType.hide(),a.everyDayTime.disable(),a.everyDayTime.hide(),a.everyHours.disable(),a.everyHours.hide(),i.sysLogView.saveMailLogBtn.setText(n.su.CHAR.SYSTEM_LOG.SAVE))}}}),this.control({"#mail-log-btn":{ev_button_click:function(){o.saveEmailFlag?o.sendEmail():(i.sysLogView.setMailTip.show(),i.sysLogView.mailLogMsg.show()),i.sysLogView.sendEmailStatus.hide()}},"#save-local-btn":{ev_button_click:function(){o.saveLog()}},"#mail-edit-btn":{ev_button_click:function(){i.sysLogView.setMailTip.hide(),i.sysLogView.mailLogMsg.show(),i.sysLogView.sendEmailStatus.hide()}},"#mail-log-msg-submit-btn":{ev_button_click:function(){t.saveLogModel.submit({success:function(e){o.saveEmailFlag=!0,i.sysLogView.mailToLabel.setValue(t.saveLogModel.to.getValue()),i.sysLogView.mailLogMsg.hide(),i.sysLogView.setMailTip.hide(),"on"===t.saveLogModel.autoMail.getValue()&&"hours"===t.saveLogModel.autoMailType.getValue()&&o.sendEmail(),t.saveLogModel.to.getValue()&&i.sysLogView.autoMailField.show()},fail:function(e){i.sysLogView.mailLogMsg.hide()},error:function(e){i.sysLogView.mailLogMsg.hide()}})}},"#mail-log-msg-cancel-btn":{ev_button_click:function(){i.sysLogView.mailLogMsg.hide()}},"#system-log-information":{ev_grid_action_click:function(e,s){l.ajax.request({proxy:"sysLogClearProxy",success:function(e){a.sysLogStore.remove()}})}}})}},function(e,a,s,o,i,t){return{saveEmailFlag:!1,sendEmail:function(){t.ajax.request({proxy:"sendMailProxy",success:function(e){"undefined"!=typeof e.send&&(a.sysLogView.sendEmailStatus.show(),e.send?a.sysLogView.sendEmailStatus.setSuccess(n.su.CHAR.SYSTEM_LOG.SEND_OK):a.sysLogView.sendEmailStatus.setFailed(n.su.CHAR.SYSTEM_LOG.SEND_FAILED))}})},saveLog:function(){t.ajax.upload({proxy:"saveLogProxy",fileId:"save-log-file"})},filterLog:function(e){s.sysLogModel.submit({preventSuccessEvent:!0,success:function(){o.sysLogStore.load()}})},onTimeChange:function(e,s){var o=t.time.getHour24(),s=t.time.format(s,"yyyy-MM-dd HH:mm:ss",o);a.sysLogView.currentTime.setValue(s)},beforeDestroy:function(){t.time.off("on_time_change",e.onTimeChange)}}})}(jQuery);