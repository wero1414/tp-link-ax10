!function(a){a.su.moduleManager.define("operationMode",{models:["operationModeModel","operationModeControlModel","firmwareSetModel"],stores:["operationModeStore","workModeStore"],services:["ajax","device","moduleManager"],deps:["main"],views:["operationModeView","operationModeViewQs"],listeners:{ev_on_launch:function(o,t,e,i,n,r,d){a.su.IS_RG_SEC&&i.operationModeControlModel.domain.setText(a.su.CHAR.OPERATION_MODE.MODE_CHANGING_TIPS_1.replace("http","https")),i.operationModeModel.load({success:function(o){t.initMode=o.mode;var e=n.operationModeStore.getBoxlabel(o.mode);n.operationModeStore.setBoxlabel(o.mode,e+' <span class="current-text">('+a.su.CHAR.OPERATION_MODE.CURRENT+")</span>")}}),i.firmwareSetModel.load({success:function(o){t.rebootTime=1e3*i.firmwareSetModel.totalTime.getValue()||t.rebootTime}}),t.initView()}},init:function(t,o,e,i,n,r){this.listen({"models.operationModeModel":{ev_will_auto_save:function(o,e){e.preventDefault(),t.switchModeConfirm()}}}),this.control({".reboot-confirm-msg":{ev_msg_ok:function(){t.clicked||(t.clicked=!0,n.main.showMask(),t.switchMode({success:function(o){t.startReboot(t.rebootTime,function(){localStorage&&localStorage.setItem("token",""),window.location.href="http://tplinkwifi.net"})},fail:function(){n.main.hideMask(),t.clicked=!1,e.operationModeControlModel.switchFailMsg.show()},error:function(){n.main.hideMask(),t.clicked=!1,e.operationModeControlModel.switchFailMsg.show()}}))}},".home-shield-msg":{ev_msg_ok:function(){e.operationModeControlModel.rebootConfirmMsg.show()}}})}},function(e,o,t,i,n,r){return{rebootTime:6e4,clicked:!1,initMode:"router",supportHomeShield:!1,initView:function(){r.device.isCoincidedWithIptv()&&a(".operation-mode-radio").addClass("adaptive");var o=r.moduleManager.get("navigatorController").getItems();e.supportHomeShield=o&&o[3]&&"homeShield"===o[3]["name"]},modeChanged:function(){return e.initMode!==t.operationModeModel.mode.getValue()},switchModeConfirm:function(){e.modeChanged()&&(e.supportHomeShield&&"router"===e.initMode?t.operationModeControlModel.homeShieldConfirmMsg:t.operationModeControlModel.rebootConfirmMsg).show()},switchMode:function(e){e=e||{},t.operationModeModel.submit({success:function(o){e.success&&e.success(o)},fail:function(o){e.fail&&e.fail(o)},error:function(o){e.error&&e.error(o)}})},startReboot:function(o,e){o=o||9e4;t.operationModeControlModel.rebootMsg.show(function(){t.operationModeControlModel.rebootProgress.animate({duration:o,percentageStart:0,percentageEnd:100,callback:function(){t.operationModeControlModel.rebootMsg.hide(),e&&e()}})})}}})}(jQuery);