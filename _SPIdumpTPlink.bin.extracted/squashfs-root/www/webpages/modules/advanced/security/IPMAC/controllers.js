!function(g){g.su.moduleManager.define("IPMACBinding",{models:["IPMACBinding","bindGridEditorModel"],stores:["ARPGridStore","bindGridStore","devicesListStore","portForwardingConnectedDevicesStore"],services:["ajax"],deps:["main","utils"],views:["IPMACBindingView"],listeners:{ev_on_launch:function(e,t,i,n,d,a,r){t.unRegisterAutoSaveData([d.ARPGridStore]),n.IPMACBinding.load({success:function(e){"on"==e.enable&&(n.IPMACBinding.ARPList.show(),n.IPMACBinding.bindList.show())}}),d.ARPGridStore.load({success:function(){for(var e=d.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&d.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidgetChange("disable")}}),d.bindGridStore.load()}},init:function(e,n,r,o,s,c){var l,u;this.configViews({id:"IPMACBindingView",items:[{id:"grid-ARP",configs:{minLines:0,paging:{},columns:[{text:g.su.CHAR.IP_MAC_BINDING.DEVICENAME,dataIndex:"name"},{text:g.su.CHAR.IP_MAC_BINDING.MACADDRESS,dataIndex:"mac"},{text:g.su.CHAR.IP_MAC_BINDING.IPADDRESS,dataIndex:"ipaddr"},{text:g.su.CHAR.IP_MAC_BINDING.BIND,dataIndex:"enable",xtype:"customWidget",widgetName:"switch",settings:{trueValue:"on",falseValue:"off"},cls:"status l-hide xl-hide"},{text:g.su.CHAR.IP_MAC_BINDING.BIND,dataIndex:"enable",xtype:"customWidget",widgetName:"switch",settings:{trueValue:"on",falseValue:"off"},cls:"status s-hide m-hide",width:"8%"},{xtype:"actioncolumn",text:g.su.CHAR.IP_MAC_BINDING.MODIFY,renderer:function(e,t){var i='<a href="javascript:void(0)" class="grid-content-btn btn-delete">';i+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}},{id:"grid-bind",configs:{minLines:0,popEditor:{addTitle:g.su.CHAR.IP_MAC_BINDING.ADD_BINDING_ENTRY,content:"#grid-IPMACBinding-popEditor",fields:[{name:"mac"},{name:"DeviceName"},{name:"ipaddr"}]},paging:{},columns:[{text:g.su.CHAR.IP_MAC_BINDING.DEVICENAME,dataIndex:"name"},{text:g.su.CHAR.IP_MAC_BINDING.MACADDRESS,dataIndex:"mac"},{text:g.su.CHAR.IP_MAC_BINDING.IPADDRESS,dataIndex:"ipaddr"},{xtype:"actioncolumn",text:g.su.CHAR.IP_MAC_BINDING.MODIFY,renderer:function(e,t){var i='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-delete btn-delete">';i+='<span class="icon"></span>';return'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-delete btn-delete"><span class="icon"></span><span class="text"></span></a>'}}]}},{id:"ARP-select-items",configs:[{type:"logo",dataIndex:"deviceType"},{type:"deviceName",dataIndex:"DeviceName"},{type:"mac",dataIndex:"mac"},{type:"ip",dataIndex:"ipaddr"}]}]}),c.ajax.request({data:{operation:"read"},url:g.su.url("/admin/network?form=lan_ipv4"),success:function(e){l=e.ipaddr,u="custom"!=e.mask_type?e.mask_type:e.custom_value}}),this.control({"#grid-bind":{ev_grid_before_save:function(e,t){for(var i=r.bindGridEditorModel.ipaddr.getValue(),n=o.bindGridStore.getData(),d=0,a=n.length;d<a;d++)if(i==n[d].ipaddr)return r.bindGridEditorModel.ipaddr.setError(g.su.CHAR.ERROR["00000077"]),t.preventDefault(),!1;if(!s.utils.isSameNet(l,i,u))return r.bindGridEditorModel.ipaddr.setError(g.su.CHAR.ERROR["00000047"]),t.preventDefault(),!1}},"#grid-ARP":{ev_grid_tbar_refresh:function(e){o.ARPGridStore.load({success:function(){for(var e=o.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&o.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidgetChange("disable");s.main.showNotice(g.su.CHAR.COMMON.SAVED)}})},ev_grid_action_click:function(e,t){var i=o.ARPGridStore.getData(),n={};n["key"]=t;for(var d=0;d<i.length;d++)t==i[d].key&&(n["index"]=d,n["data"]=JSON.stringify(i[d]));o.ARPGridStore.removeDataByKey(t),o.ARPGridStore.getProxy().removeCustom({data:n,success:function(){for(var e=o.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&o.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidgetChange("disable");o.bindGridStore.load()}})}},"#selectARP-btn":{ev_button_click:function(e,t){n.IPMACBindingView.ARPSelectListMsg.show(),o.devicesListStore.load({success:function(){n.IPMACBindingView.ARPSelectListMsg.setPosition("center","center")}})}},"#ARP-select-items":{ev_item_click:function(e,t){var i=o.devicesListStore.getSelected()[0];r.bindGridEditorModel.ipaddr.setValue(i.ipaddr),r.bindGridEditorModel.mac.setValue(i.mac),r.bindGridEditorModel.DeviceName.setValue(i.DeviceName),n.IPMACBindingView.ARPSelectListMsg.close()}},"#grid-ARP => .switch-container":{ev_view_will_change:function(e,t){o.bindGridStore.isExceeded()&&(o.bindGridStore.showMaxRulesWarning(),t.preventDefault())}}}),this.listen({"models.IPMACBinding.enable":{ev_value_change:function(e,t,i){"on"==t&&"off"==i?(r.IPMACBinding.submit({success:function(e){o.ARPGridStore.load({success:function(){for(var e=o.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&o.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidgetChange("disable")}})}}),r.IPMACBinding.ARPList.show(),r.IPMACBinding.bindList.show()):"off"==t&&"on"==i&&(r.IPMACBinding.submit({success:function(e){o.ARPGridStore.load({success:function(){for(var e=o.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&o.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidget().disable()}})}}),r.IPMACBinding.ARPList.hide(),r.IPMACBinding.bindList.hide())}},"stores.ARPGridStore":{ev_data_change:function(e,t,i){if("on"==t.value){var n=arguments[3].getData(),d=o.bindGridStore,a=o.ARPGridStore.getData();if(d){curStoreData=d.getData();for(var r=0;r<curStoreData.length&&n.ipaddr!=curStoreData[r].ipaddr;r++);var s={operation:"bind"};s["data"]=JSON.stringify(n),s["key"]=n.key;for(r=0;r<a.length;r++)s["key"]==a[r].key&&(s["index"]=r);c.ajax.request({url:g.su.url("/admin/imb?form=arp_list"),data:s,success:function(e){o.bindGridStore.load()}})}}arguments[3].enable.getInnerWidgetChange("disable")}},"stores.bindGridStore.dataObj":{ev_store_sync_success:function(e,t,i,n){o.ARPGridStore.load({success:function(){for(var e=o.ARPGridStore.getData(),t=0;t<e.length;t++)"on"==e[t].enable&&o.ARPGridStore.getSubModelBindByKey(e[t].key).enable.getInnerWidgetChange("disable")}})}}})}},function(e,t,i,n,d,a){return{}})}(jQuery);