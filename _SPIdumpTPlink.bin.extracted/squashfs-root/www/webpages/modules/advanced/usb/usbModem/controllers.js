!function(b){b.su.moduleManager.define("usbModem",{services:["ajax"],models:["usbModemEnable","usbModemConfig"],stores:["gLocationS","gMobileIspS","gConnectionModeS","gAuthTypeS"],views:["usbModemView"],listeners:{ev_on_launch:function(e,o,s,n,i,a,d){n.usbModemEnable.enable.setValue(null),n.usbModemEnable.load()},ev_before_destroy:function(e,o){clearInterval(o.modemInterval)}},init:function(n,i,a,d,e,o){this.control({"#g_location":{ev_view_change:function(e){clearInterval(n.modemInterval)}},"#g_mobile_isp":{ev_view_change:function(e){clearInterval(n.modemInterval)}},"#g_btn_connect":{ev_button_click:function(e){a.usbModemConfig.submit({data:{operation:"connect"},success:function(e){n.setConnectstatus(e.connectstatus)}})}},"#g_btn_disconnect":{ev_button_click:function(e){o.ajax.request({proxy:"modemConnectProxy",data:{operation:"disconnect"},success:function(e){n.setConnectstatus(e.connectstatus),"0"!=e.pinlock&&"4"!=e.pinlock||"2"!=e.modemstatus||"0"!=e.connectstatus?i.usbModemView.btnConnect.disable():i.usbModemView.btnConnect.enable(),"2"!=e.modemstatus||"1"!=e.connectstatus&&"2"!=e.connectstatus?i.usbModemView.btnDisconnect.disable():i.usbModemView.btnDisconnect.enable()}}),clearInterval(n.modemInterval),n.modemInterval=setInterval(n.fncInterval,3e3)}}}),this.listen({"models.usbModemEnable.enable":{ev_value_change:function(e,o,s){s&&s!==o&&a.usbModemEnable.submit(),"on"==o&&s!==o?(n.initModem(),i.usbModemView.modemConfig.show()):"off"==o&&s!==o&&(clearInterval(n.modemInterval),i.usbModemView.modemConfig.hide())}},"models.usbModemConfig.locindex":{ev_value_change:function(e,o,s){o!=s&&(d.gMobileIspS.loadData(n.locationStack[o].ispList),1==n.firstLoad?(s=a.usbModemConfig.ispindex.getValue(),a.usbModemConfig.ispindex.setValue(s),n.firstLoad=!1):0!=n.locationStack[o].ispList.length&&a.usbModemConfig.ispindex.setValue("0"))}},"models.usbModemConfig.ispindex":{ev_value_change:function(e,o,s){null!=o&&o!=s&&(s=a.usbModemConfig.locindex.getValue(),a.usbModemConfig.dial_num.setValue(n.locationStack[s]["isp"+o].dial_num),a.usbModemConfig.apn.setValue(n.locationStack[s]["isp"+o].apn),a.usbModemConfig.username.setValue(n.locationStack[s]["isp"+o].username),a.usbModemConfig.password.setValue(n.locationStack[s]["isp"+o].password),a.usbModemConfig.dial_num_hidden.setValue(n.locationStack[s]["isp"+o].dial_num),a.usbModemConfig.apn_hidden.setValue(n.locationStack[s]["isp"+o].apn),a.usbModemConfig.username_hidden.setValue(n.locationStack[s]["isp"+o].username),a.usbModemConfig.password_hidden.setValue(n.locationStack[s]["isp"+o].password))}},"models.usbModemConfig.setisp":{ev_value_change:function(e,o,s){"manual"==o?(a.usbModemConfig.locindex.disable(),a.usbModemConfig.ispindex.disable(),a.usbModemConfig.dial_num.enable(),a.usbModemConfig.apn.enable(),a.usbModemConfig.username.enable(),a.usbModemConfig.password.enable()):(a.usbModemConfig.locindex.enable(),a.usbModemConfig.ispindex.enable(),a.usbModemConfig.dial_num.disable(),a.usbModemConfig.apn.disable(),a.usbModemConfig.username.disable(),a.usbModemConfig.password.disable())}},"models.usbModemConfig.connectmode":{ev_value_change:function(e,o,s){"auto"==o?a.usbModemConfig.maxidletime.disable():a.usbModemConfig.maxidletime.enable()}},"models.usbModemConfig.manualdns":{ev_value_change:function(e,o,s){"on"==o||"manualdns"==o?(a.usbModemConfig.primarydns.enable(),a.usbModemConfig.seconddns.enable()):(a.usbModemConfig.primarydns.disable(),a.usbModemConfig.seconddns.disable())}}})}},function(t,u,m,c,e,o){t=this;return{modemInterval:null,locationStack:{},firstLoad:!0,initModem:function(){o.ajax.request({proxy:"ispListProxy",data:{operation:"read"},success:function(e){var o,s=[];for(o in e){var n=o.slice(8);t.locationStack[n]={},t.locationStack[n]["regionCode"]=n,t.locationStack[n]["regionName"]=e[o]["location_name"];for(var i,a,d=0;d<s.length&&!(+n<+s[d].value);d++);for(i in s.splice(d,0,{name:b.su.CHAR.REGION[e[o]["location_name"].toUpperCase()],value:n}),t.locationStack[n]["ispList"]=[],e[o])"isp"==i.slice(0,3)&&(a=i.slice(3),t.locationStack[n]["ispList"].splice(a,0,{name:b.su.CHAR.MODEM_ISP[e[o][i]["isp_name"].toUpperCase()],value:i.slice(3)}),t.locationStack[n][i]=e[o][i])}c.gLocationS.loadData(s),m.usbModemConfig.load({success:function(e){t.setModemstatus(e.modemstatus),"manual"==e.setisp?(m.usbModemConfig.locindex.disable(),m.usbModemConfig.ispindex.disable(),m.usbModemConfig.dial_num.enable(),m.usbModemConfig.apn.enable(),m.usbModemConfig.username.enable(),m.usbModemConfig.password.enable()):(m.usbModemConfig.locindex.enable(),m.usbModemConfig.ispindex.enable(),m.usbModemConfig.dial_num.disable(),m.usbModemConfig.apn.disable(),m.usbModemConfig.username.disable(),m.usbModemConfig.password.disable()),t.setPinlock(e.pinlock),t.setConnectstatus(e.connectstatus),"0"!=e.pinlock&&"4"!=e.pinlock||"2"!=e.modemstatus||"0"!=e.connectstatus?u.usbModemView.btnConnect.disable():u.usbModemView.btnConnect.enable(),"2"!=e.modemstatus||"1"!=e.connectstatus&&"2"!=e.connectstatus?u.usbModemView.btnDisconnect.disable():u.usbModemView.btnDisconnect.enable(),clearInterval(t.modemInterval),t.modemInterval=setInterval(t.fncInterval,3e3)}})}}),u.usbModemView.authenTypeTips.setValue(b.su.CHAR.G3_G4.AUTH_TYPE_TIP),u.usbModemView.btnConnect.disable()},setModemstatus:function(e){var o="";switch(e){case"0":o=b.su.CHAR.G3_G4.UNPLUGGED;break;case"1":o=b.su.CHAR.G3_G4.IDENTIFYING;break;case"2":o=b.su.CHAR.G3_G4.IDENTIFY_SUCCESS;break;default:o=b.su.CHAR.G3_G4.UNKNOWN_MODE}u.usbModemView.modemstatus.setHTML(o)},setConnectstatus:function(e){switch(e){case"0":u.usbModemView.connectStatus.setFailed(b.su.CHAR.OPERATION.DISCONNECTED);break;case"1":u.usbModemView.connectStatus.setSuccess(b.su.CHAR.OPERATION.CONNECTED);break;case"2":u.usbModemView.connectStatus.setLoading(b.su.CHAR.OPERATION.CONNECTING);break;case"3":u.usbModemView.connectStatus.setLoading(b.su.CHAR.OPERATION.DISCONNECTING)}u.usbModemView.connectStatus.show()},setPinlock:function(e){switch(e){case"0":m.usbModemConfig.pincode.disable(),m.usbModemConfig.pincode.hide(),u.usbModemView.modemMessage.hide();break;case"1":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.removeReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_1),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"2":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_2),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"3":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.removeReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_3),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"4":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_4),u.usbModemView.modemMessage.setTextColor("#599E00");break;case"5":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_5),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"6":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_6),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"7":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_7),u.usbModemView.modemMessage.setTextColor("#C11C66");break;case"8":m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.setReadonly(),u.usbModemView.modemMessage.show(),u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_8),u.usbModemView.modemMessage.setTextColor("#C11C66")}},fncInterval:function(){o.ajax.request({proxy:"modemConnectProxy",data:{operation:"read"},success:function(e){t.setModemstatus(e.modemstatus),"1"!=e.pinlock&&"3"!=e.pinlock?t.setPinlock(e.pinlock):(m.usbModemConfig.pincode.enable(),m.usbModemConfig.pincode.show(),m.usbModemConfig.pincode.removeReadonly(),u.usbModemView.modemMessage.show(),m.usbModemConfig.pincode.isDirty()||m.usbModemConfig.pincode.getValue()===e.pincode||(m.usbModemConfig.pincode.setValue(e.pincode),m.usbModemConfig.pincode.record()),"1"==e.pinlock?u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_1):u.usbModemView.modemMessage.setValue(b.su.CHAR.G3_G4.PINLOCK_3)),t.setConnectstatus(e.connectstatus),"0"!=e.pinlock&&"4"!=e.pinlock||"2"!=e.modemstatus||"0"!=e.connectstatus?u.usbModemView.btnConnect.disable():u.usbModemView.btnConnect.enable(),"2"!=e.modemstatus||"1"!=e.connectstatus&&"2"!=e.connectstatus?u.usbModemView.btnDisconnect.disable():u.usbModemView.btnDisconnect.enable(),m.usbModemConfig.locindex.setValue(e.locindex),m.usbModemConfig.ispindex.setValue(e.ispindex)}})}}})}(jQuery);