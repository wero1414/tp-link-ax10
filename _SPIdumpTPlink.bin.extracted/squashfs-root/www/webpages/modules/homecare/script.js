!function(d){d.su.moduleManager.define("bandwidth",{deps:["main"],services:["ajax","device"],models:["totalBandwidth","bandwidthSpeedTestControl"],stores:["bandwidthSetTypeStore","bandwidthUnitStore"],views:["bandwidthView"],listeners:{ev_on_launch:function(e,a,i,r,t,s,o){this.unRegisterAutoSaveData([r.totalBandwidth,r.bandwidthSpeedTestControl]),0==o.device.getConfig().supportAutoSpeedTest&&r.totalBandwidth.bandwidthMode.hide();var l=!1;o.ajax.request({proxy:"speedRecordProxy",ajax:{"async":!1},success:function(e){d.isArray(e)&&0!==e.length||(l=!0)}}),this.control({".total-bandwidth .edit-icon":{click:function(){a.showBandwithMsg()}},"#set-bandwidth-msg":{ev_msg_ok:function(e,t){var n;t.preventDefault(),!0===r.totalBandwidth.validate()&&("manual"===r.totalBandwidth.bandwidthMode.getValue()?(t={},(n={}).value=Number(r.totalBandwidth.upstreamSpeedTrans.getValue()),t.value=Number(r.totalBandwidth.downstreamSpeedTrans.getValue()),n.unit=r.totalBandwidth.upstreamUnitTrans.getValue(),t.unit=r.totalBandwidth.downstreamUnitTrans.getValue(),n=a.joinSpeed(n),t=a.joinSpeed(t),r.totalBandwidth.upstreamBandwidth.setValue(n),r.totalBandwidth.downstreamBandwidth.setValue(t),r.totalBandwidth.submit({success:function(e){r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close()}})):o.ajax.request({proxy:"bandwidthCheckInternetProxy",success:function(){r.totalBandwidth.submit({success:function(e){l?o.ajax.request({proxy:"checkPrivicyProxy",method:"read",success:function(e){i.bandwidthView.setBandwidthMsg.close(),e.enable?(a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()):i.bandwidthView.speedtestPrivacyMsg.show()}}):(r.totalBandwidth.loadData(e),i.bandwidthView.setBandwidthMsg.close())}})},fail:function(){s.main.showError(d.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)},error:function(){s.main.showError(d.su.CHAR.BANDWIDTH.NO_INTERNET_NOTE)}}))},ev_msg_cancel:function(e,t){this.trigger("ev_qos_save_cancel")},ev_msg_close:function(e,t){this.trigger("ev_qos_save_close")}},"#speedtest-privacy-msg":{ev_msg_ok:function(e,t){t.preventDefault(),o.ajax.request({proxy:"checkPrivicyProxy",method:"write",data:{enable:!0},success:function(){i.bandwidthView.speedtestPrivacyMsg.close(),a.initSpeedtest(),i.bandwidthView.speedtestMsg.show(),a.startSpeedTest()}})},ev_msg_cancel:function(e,t){i.bandwidthView.setBandwidthMsg.show()}},"#speedtest-msg":{ev_msg_close:function(e){i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},"#speedtest-msg-cancel-btn":{ev_button_click:function(e){i.bandwidthView.speedtestMsg.hide(),i.bandwidthView.setBandwidthMsg.show(),a.stopSpeedTest()}},".bandwidth-speedtest-btn":{ev_button_click:function(){a.startSpeedTest()}}}),this.listen({"models.totalBandwidth.bandwidthMode":{ev_value_change:function(e,t){"manual"===t?i.bandwidthView.bandwidthSetManual.show():(i.bandwidthView.bandwidthSetManual.hide(),l?r.totalBandwidth.bandwidthMode.showItemContent(["auto"]):r.totalBandwidth.bandwidthMode.hideItemContent(["auto"]))}},"models.totalBandwidth":{ev_model_submit:function(){this.trigger("ev_qos_saved")}},"models.totalBandwidth.upstreamUnitTrans":{ev_value_change:function(e,t,n){"kbps"===t?r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxUpload.getValue()}):r.totalBandwidth.upstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxUpload.getValue()/1024)})}},"models.totalBandwidth.downstreamUnitTrans":{ev_value_change:function(e,t,n){"kbps"===t?r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:r.totalBandwidth.maxDownload.getValue()}):r.totalBandwidth.downstreamSpeedTrans.setVtype({vtype:"float_number",min:0,max:Math.floor(r.totalBandwidth.maxDownload.getValue()/1024)})}}}),r.totalBandwidth.load()}},init:function(e,t,n,a,i,r){}},function(i,t,n,e,a,r){var s=null;return{hasConfigured:function(){return-1!==parseInt(n.totalBandwidth.downstreamBandwidth.getValue(),10)},showBandwithMsg:function(){t.bandwidthView.setBandwidthMsg.show()},isSpeedTesting:!1,joinSpeed:function(e){var t=e.value;return"mbps"===e.unit&&(t*=1024),t},initSpeedtest:function(){i.initDownloadChart(),i.initUploadChart()},initDownloadChart:function(){n.bandwidthSpeedTestControl.speedTestDownload.setOption({name:d.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},initUploadChart:function(){n.bandwidthSpeedTestControl.speedTestUpload.setOption({name:d.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},setDownloadChartSpeed:function(e){n.bandwidthSpeedTestControl.speedTestDownload.setOption({value:i.normalizeSpeed(e),name:d.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},setUploadChartSpeed:function(e){n.bandwidthSpeedTestControl.speedTestUpload.setOption({value:i.normalizeSpeed(e),name:d.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_UPPER,convert:[0,5,10,25,50,100,300,1e3,2500]})},startSpeedTest:function(){n.bandwidthSpeedTestControl.speedTestBtn.hide(),n.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(i.transformSpeedUnit(0)),i.setUploadChartSpeed(i.transformSpeedUnit(0)),i.isSpeedTesting=!0,clearInterval(s),i.getSpeedTestResult({proxy:"startSpeedTestProxy",success:function(e){s=setInterval(function(){i.continueSpeedTest()},2e3)}})},continueSpeedTest:function(){i.getSpeedTestResult({proxy:"readSpeedTestProxy",success:function(e){"idle"===e.status?(i.isSpeedTesting=!1,clearInterval(s),i.setSpeedTestResult(e),n.totalBandwidth.load(),t.bandwidthView.speedtestMsg.close()):"down_test"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(d.su.CHAR.NETWORK_MAP.DOWNLOAD_SPEED_TEST),i.setDownloadChartSpeed(i.transformSpeedUnit(e.downSpeed)),i.setUploadChartSpeed(i.transformSpeedUnit(e.upSpeed))):"up_test"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(d.su.CHAR.NETWORK_MAP.UPLOAD_SPEED_TEST),i.setDownloadChartSpeed(i.transformSpeedUnit(e.downSpeed)),i.setUploadChartSpeed(i.transformSpeedUnit(e.upSpeed))):"fail"===e.status?(n.bandwidthSpeedTestControl.speedTestInfo.setText(d.su.CHAR.BANDWIDTH.SPEED_TEST_FAILED),i.isSpeedTesting=!1,clearInterval(s),i.setSpeedTestResult(e),n.bandwidthSpeedTestControl.speedTestBtn.show()):(n.bandwidthSpeedTestControl.speedTestInfo.setText("&nbsp;"),i.setDownloadChartSpeed(0),i.setUploadChartSpeed(0))},fail:function(e){i.isSpeedTesting=!1,clearInterval(s),s=null,i.setSpeedTestResult(data)}})},getSpeedTestResult:function(e){var t,n,a="readSpeedTestProxy";e&&(t=e.success,n=e.fail,a=e.proxy||a),r.ajax.request({proxy:a,preventSuccessEvent:e.preventSuccessEvent,success:function(e){i.isRunning()&&t&&t(e)},fail:function(e){i.isRunning()&&n&&n(e)}})},setSpeedTestResult:function(e){var t=i.transformSpeedUnit(e.upSpeed),e=i.transformSpeedUnit(e.downSpeed);i.setDownloadChartSpeed(e),i.setUploadChartSpeed(t)},stopSpeedTest:function(){i.getSpeedTestResult({proxy:"stopSpeedTestProxy",success:function(e){i.isSpeedTesting=!1,clearInterval(s),s=null,i.setSpeedTestResult(e)}})},normalizeSpeed:function(e){return isNaN(e)||e<0?0:e},transformSpeedUnit:function(e){return(!e||e<0)&&(e=0),1e3<=(e/=1024)?parseInt(e,10):parseFloat(e.toFixed(2))}}})}(jQuery),function(r){r.su.modelManager.define("totalBandwidth",{type:"model",fields:[{name:"bandwidthMode",mapping:"bandwidth_mode"},{name:"upstreamBandwidth",mapping:"upstream_bandwidth"},{name:"downstreamBandwidth",mapping:"downstream_bandwidth"},{name:"maxUpload",mapping:"max_upload",disabled:!0},{name:"maxDownload",mapping:"max_download",disabled:!0},{name:"upstreamBandwidthTrans",mapping:"upstream_bandwidth_trans",disabled:!0},{name:"downstreamBandwidthTrans",mapping:"downstream_bandwidth_trans",disabled:!0},{name:"upstreamSpeedTrans",mapping:"upstream_speed_trans",allowBlank:!1,disabled:!0},{name:"upstreamUnitTrans",mapping:"upstream_unit_trans",disabled:!0},{name:"downstreamSpeedTrans",mapping:"downstream_speed_trans",allowBlank:!1,disabled:!0},{name:"downstreamUnitTrans",mapping:"downstream_unit_trans",disabled:!0},{name:"gameMode",mapping:"game_mode"}],convert:function(e){var t={mbps:r.su.CHAR.BANDWIDTH.SPEED_M,kbps:r.su.CHAR.BANDWIDTH.SPEED_K};function n(e){var t={value:0,unit:"kbps"};return e/1024<1?(t.value=e<1e3?e.toFixed(1):e.toFixed(0),t.unit="kbps"):(t.value=(e/1024).toFixed(1),t.unit="mbps"),t}var a=n(e.upstream_bandwidth),i=n(e.downstream_bandwidth);return a.value&&"NaN"!=a.value&&-1!=e.upstream_bandwidth?(e.upstream_bandwidth_trans=a.value+" "+t[a.unit],e.upstream_speed_trans=a.value,e.upstream_unit_trans=a.unit):(e.upstream_bandwidth_trans="---",e.upstream_speed_trans="",e.upstream_unit_trans="mbps"),i.value&&"NaN"!=i.value&&-1!=e.downstream_bandwidth?(e.downstream_bandwidth_trans=i.value+" "+t[i.unit],e.downstream_speed_trans=i.value,e.downstream_unit_trans=i.unit):(e.downstream_bandwidth_trans="---",e.downstream_speed_trans="",e.downstream_unit_trans="mbps"),e},proxy:{url:r.su.url("/admin/smart_network?form=tm_qos")}}),r.su.storeManager.define("bandwidthSetTypeStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"},{name:"content"}],data:[{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,value:"auto",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO,content:"<span>"+r.su.CHAR.BANDWIDTH.BAND_TYPE_AUTO_NOTE+"</span>"},{name:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,value:"manual",boxlabel:r.su.CHAR.BANDWIDTH.BAND_TYPE_MANUAL,content:""}]}),r.su.storeManager.define("bandwidthUnitStore",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}],data:[{name:r.su.CHAR.BANDWIDTH.SPEED_M,value:"mbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_M},{name:r.su.CHAR.BANDWIDTH.SPEED_K,value:"kbps",boxlabel:r.su.CHAR.BANDWIDTH.SPEED_K}]}),r.su.define("speedRecordProxy",{extend:"IPFProxy",preventSuccessEvent:!0,preventFailEvent:!0,preventErrorEvent:!0,url:r.su.url("/admin/status?form=speedtest"),writeFilter:function(e){return{operation:"get"}}}),r.su.define("bandwidthCheckInternetProxy",{extend:"IPFProxy",url:r.su.url("/admin/quick_setup?form=check_internet"),writeFilter:function(e){return{operation:"read"}}}),r.su.define("checkPrivicyProxy",{extend:"IPFProxy",url:r.su.url("/admin/qos?form=check_privicy")}),r.su.modelManager.define("bandwidthSpeedTestControl",{type:"model",fields:[{name:"speedTestInfo"},{name:"speedTestChartContainer"},{name:"speedTestDownload"},{name:"speedTestUpload"},{name:"speedTestBtn"}],proxy:null}),r.su.define("startSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),preventSuccessEvent:!0,writeFilter:function(e){return r.extend({operation:"start"},e)}}),r.su.define("readSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),writeFilter:function(e){return r.extend({operation:"read"},e)},readFilter:function(e){return{testTime:e.data.test_time,upSpeed:e.data.up_speed,downSpeed:e.data.down_speed,status:e.data.status}}}),r.su.define("stopSpeedTestProxy",{extend:"IPFProxy",url:r.su.url("/admin/status?form=speedtest"),preventSuccessEvent:!0,writeFilter:function(e){return r.extend({operation:"stop"},e)},readFilter:function(e){return{testTime:e.data.test_time,upSpeed:e.data.up_speed,downSpeed:e.data.down_speed}}})}(jQuery),function(_){_.su.moduleManager.define("parentalControlsV2Optimize",{deps:["main","index"],services:["ajax","time","moduleManager","device"],models:["ptcrEditorModel","ptcrEnableV3","ptcrViewModel"],stores:["parentalControlsStoreV3","ptcrDayOptionsV3","ptcrOnlineDevs","ptcrOfflineDevs","ptcrSelectedDevs","dailyTimeLimitSV3","ptcrDayWeeks","websiteStore","ptcrModeOpts"],views:["parentalControlsV2OptimizeView"],listeners:{ev_on_launch:function(e,t,n,a,i,r,s){var t=this,o=n.parentalControlsV2OptimizeView;a.ptcrEnableV3.load({success:function(e){"on"===e.enable?o.ptcrContent.show():o.ptcrContent.hide()}}),i.parentalControlsStoreV3.load({success:function(e){0<e.length?o.emptyGrid.hide():o.emptyGrid.show()}}),s.ajax.request({proxy:"profileLimitProxyV3",method:"read",ajax:{"async":!1},success:function(e){t.profileLimit.profileLength=Number(e.profileLength),t.profileLimit.devicesLength=Number(e.devicesLength),t.profileLimit.categoryLength=Number(e.categoryLength)}}),i.parentalControlsStoreV3.setMaxRules(t.profileLimit.profileLength),s.time.on("on_time_change",t.onTimeChange),s.time.on("on_hour24_change",t.onHour24Change),_("#add-name-conflict-hint").find("span.text").html(_.su.CHAR.PTCR_V2_OPTIMIZE.GENERAL_CONFLICT)},ev_before_destroy:function(e,t,n,a,i,r,s){t.destoryChart(),s.time.off("on_time_change",t.onTimeChange),s.time.off("on_hour24_change",t.onHour24Change)}},init:function(l,d,c,u,p,m){var o=d.parentalControlsV2OptimizeView;var t={mon:_.su.CHAR.DATEPICKER.MONDAY,tue:_.su.CHAR.DATEPICKER.TUESDAY,wed:_.su.CHAR.DATEPICKER.WEDNESDAY,thu:_.su.CHAR.DATEPICKER.THURSDAY,fri:_.su.CHAR.DATEPICKER.FRIDAY,sat:_.su.CHAR.DATEPICKER.SATURDAY,sun:_.su.CHAR.DATEPICKER.SUNDAY};this.configViews({id:"parentalControlsV2OptimizeView",items:[{id:"ptcr-grid",configs:{popEditor:{addTitle:_.su.CHAR.PTCR_V2_OPTIMIZE.ADD_PROFILE,editTitle:_.su.CHAR.PTCR_V2_OPTIMIZE.EDIT_PROFILE,content:"#ptcr-grid-editor-v2",customBtns:"#parental-ctrls-add-btns",msg:{}},paging:{items:[{name:"8",value:8,selected:!0}]},columns:[{text:_.su.CHAR.PTCR_V2_OPTIMIZE.PROFILE_NAME,dataIndex:"name",width:100,renderer:function(e,t){return m.device.getConfig().supportPatrolMark&&1===t.rule_mark?e+'<span class="pcgrid-red-dot"></span>':e}},{text:_.su.CHAR.PTCR_V2_OPTIMIZE.ONLINE_LIMIT,width:150,renderer:function(e,t){var n=m.time.getTime().getDay(),n=1<=n&&n<=5?t.enableWorkdayTimeLimit?t.workdayDailyTime:-1:t.enableWeekendTimeLimit?t.weekendDailyTime:-1,t=t.onlineTotal;return(0<t?l.min2TimeText(t):0)+" / "+(0<n?l.min2TimeText(n):"--")}},{dataIndex:"internetBlocked",text:_.su.CHAR.PTCR_V2_OPTIMIZE.INTERNET_ACCESS,width:140,renderer:function(e,t){return!0===e?_.su.CHAR.PTCR_V2_OPTIMIZE.ACCESS_DENY:_.su.CHAR.PTCR_V2_OPTIMIZE.ACCESS_ALLOW}},{xtype:"actioncolumn",text:_.su.CHAR.PTCR_V2_OPTIMIZE.ACTION,dataIndex:"internetBlocked",width:200,renderer:function(e,t){var n="<span class='seperator'>|</span>",a="";return(a+='<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-internet-access btn-internet-access '+(!0===e?"off":"on")+'">')+('<span class="icon" data-tip=\''+(!0===e?_.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW:_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK)+"'></span>")+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit">'+('<span class="icon" data-tip="'+_.su.CHAR.PTCR_V2_OPTIMIZE.EDIT+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-insight btn-insight">'+('<span class="icon" data-tip="'+_.su.CHAR.PTCR_V2_OPTIMIZE.VIEW+'"></span>')+'<span class="text"></span>'+"</a>"+n+'<a href="javascript:void(0)" class="grid-content-btn grid-content-custom-btn-delete btn-delete">'+('<span class="icon" data-tip="'+_.su.CHAR.OPERATION.DELETE+'"></span>')+'<span class="text"></span>'+"</a>"}}]}},{id:"parental-ctrls-insight-tabs",fields:[{text:_.su.CHAR.PTCR_V2_OPTIMIZE.TIME_TAB,name:"time-chart",container:"time-chart"},{text:_.su.CHAR.PTCR_V2_OPTIMIZE.WEB_TAB,name:"website-list",container:"website-list"}]},{id:"ptcr-edit-tabs",fields:[{text:_.su.CHAR.PTCR_V2_OPTIMIZE.BASIC_INFO,name:"basic-info",container:"basic-info"},{text:_.su.CHAR.PTCR_V2_OPTIMIZE.FILTER_CONTENT,name:"filter-level",container:"filter-level"},{text:_.su.CHAR.PTCR_V2_OPTIMIZE.TIME_CONTROL,name:"time-controls",container:"time-controls"}]},{id:"ptcr-online-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+_.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+_.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+_.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-offline-devices",configs:[{type:"deviceType",dataIndex:"clientType",renderer:function(e){return"<span class='device-icon "+_.su.escapeHtml(e.toLowerCase())+"'></span>"}},{type:"deviceName",dataIndex:"name",renderer:function(e,t){t=t.ownerName;return'<span class="single-line">'+_.su.escapeHtml(e)+'</span><span class="single-line'+(0<t.length?" tag":"")+'">'+_.su.escapeHtml(t)+"</span>"}},{type:"mac",dataIndex:"mac"}]},{id:"ptcr-selected-devices",itemRender:function(e,t){return'<div class="device-wrap">\t\t\t\t\t\t\t\t\t\t\t<span class="del-icon" data-mac="%MAC%"></span>\t\t\t\t\t\t\t\t\t\t\t<div class="name-tag-group">\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="name single-line">%NAME%</span>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class="%TAG% single-line">%PROFILE%</span>\t\t\t\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t\t\t\t\t<span class="mac">\t\t\t\t\t\t\t\t\t\t\t\t%MAC%</span>\t\t\t\t\t\t\t\t\t\t\t<span class="device-icon %TYPE%">\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t</div>'.replace(/\%MAC\%/g,_.su.escapeHtml(t.mac)).replace(/\%NAME\%/g,_.su.escapeHtml(t.name)).replace(/\%TYPE\%/g,_.su.escapeHtml(t.clientType)).replace(/\%PROFILE\%/g,_.su.escapeHtml(t.ownerName)).replace(/\%TAG\%/g,0<t.ownerName.length?"tag":"")}},{id:"insight-website-list",itemRender:function(e,t){return"<div class='website-item'>\t\t\t\t\t\t\t\t\t\t\t<span class='spent'>%TIME</span>\t\t\t\t\t\t\t\t\t\t\t<span class='url single-line'>%URL</span>\t\t\t\t\t\t\t\t\t\t\t<span class='block-container'>\t\t\t\t\t\t\t\t\t\t\t\t<span class='%EXTRACLASSblock-icon' data-url='%URL' data-tip='%HINT' data-pointer='left'>\t\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t\t</span>\t\t\t\t\t\t\t\t\t\t</div>".replace(/\%URL/g,_.su.escapeHtml(t.website)).replace(/\%TIME/,_.su.escapeHtml(t.duration)).replace(/\%HINT/g,t.block?_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCKED:_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK).replace(/\%EXTRACLASS/g,t.block?"disabled ":"")}},{id:"ptcr-dev-list",renderer:function(e){var t="";return(t+='<span class="icon device-type '+_.su.escapeHtml(e.clientType)+'"></span>')+('<span class="text single-line">'+_.su.escapeHtml(e.name)+"</span>")}},{id:"black-url-list",renderer:function(e){return'<span class="text single-line">'+_.su.escapeHtml(e)+"</span>"}},{id:"white-url-list",renderer:function(e){return'<span class="text single-line">'+_.su.escapeHtml(e)+"</span>"}},{id:"ptcr-time-list",renderer:function(e){return'<span class="week">'+t[e.whichDay]+'</span><span class="hour">'+l.hourFormatter(e.range[0])+" - "+l.hourFormatter(e.range[1])+"</span>"}},{id:"weekend-slider",configs:{convertValue:function(e){return l.min2TimeText(e)}},anchors:[30]},{id:"weekday-slider",configs:{convertValue:function(e){return l.min2TimeText(e)}},anchors:[30]}]}),this.listen({"models.ptcrEnableV3.enable":{ev_value_change:function(e,t,n){"on"===t?o.ptcrContent.show():o.ptcrContent.hide()}},"stores.parentalControlsStoreV3":{ev_loaded:function(){0<u.parentalControlsStoreV3.getSize()?o.emptyGrid.hide():o.emptyGrid.show()},ev_before_sync:function(e,t){t.preventDefault(),u.parentalControlsStoreV3.sync({success:function(e){u.parentalControlsStoreV3.loadData(e,!0)}})}},"views.parentalControlsV2OptimizeView.ptcrDayOrWeek":{ev_value_change:function(e,t,n){"day"===t?(o.parentalCtrlDaySlt.setValue(0),o.parentalCtrlDaySlt.show(),o.dayReportXLabel.show()):(o.dayReportXLabel.hide(),l.renderWeeklyChart(),(t=l.getInsightsData()).dayIndex=-1,l.renderHistoryCollection(t.weekSummary.websites,t.webType),o.parentalCtrlDaySlt.hide())}},"views.parentalControlsV2OptimizeView.parentalCtrlDaySlt":{ev_value_change:function(e,t,n){var a=l.getInsightsData(),i=a.data[t];a.dayIndex=t,i&&(t=0<i.time_limit?l.min2TimeText(i.time_limit):null,l.renderDailyChart(i.spend_online,i.per_hour,t),l.renderHistoryCollection(i.website_list,a.webType))}},"models.ptcrEditorModel.name":{ev_value_change:function(e,t){l.changeBtnStatus()}},"models.ptcrEditorModel.clientList":{ev_value_change:function(e,t,n){l.changeBtnStatus()}},"models.ptcrEditorModel.websiteType":{ev_value_change:function(e,t,n){var a=c.ptcrEditorModel,i=a.whiteList,a=a.blackList,r=o.webListNote;"black"==t?(i.hide(),a.show(),r.setField("TITLE",_.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_LIST),r.setField("TIP",_.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_TIPS)):(i.show(),a.hide(),r.setField("TITLE",_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_LIST),r.setField("TIP",_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_TIPS))}},"models.ptcrEditorModel.enableWeekendTimeLimit":{ev_value_change:function(e,t,n){var a=c.ptcrEditorModel.weekendDailyTime,i=o.disableWeekendNote;t?(a.show(),i.hide()):(a.hide(),i.show())}},"models.ptcrEditorModel.enableWorkdayTimeLimit":{ev_value_change:function(e,t,n){var a=c.ptcrEditorModel.workdayDailyTime,i=o.disableWeekdayNote;t?(a.show(),i.hide()):(a.hide(),i.show())}}}),this.control({"#parental-enable":{ev_view_change:function(){c.ptcrEnableV3.submit()}},"#system-time-settings":{ev_button_click:function(){m.moduleManager.get("navigatorController").goTo("timeSettings")}},"#ptcr-website-type":{ev_view_change:function(e,t){var n,a;"value"===t.type&&(t=t.value,n=(a=c.ptcrEditorModel).whiteList,a=a.blackList,c.ptcrViewModel.url.reset(),("black"==t?n:a).reset())}},"#ptcr-grid => a.btn-insight":{ev_grid_action_click:function(e,t){_.when(l.fetchInsightsData(t),l.initBarChart()).then(function(){o.parentalCtrlsInsightSwitch.itemClick("time-chart"),u.ptcrDayOptionsV3.loadData(l.refreshDAYS().reverse()),o.ptcrDayOrWeek.setValue("day"),o.parentalCtrlsInsightMsg.show()})}},"#insight-website-list => .block-icon":{click:function(e){var t,n,a=_(e.target||e.currentTarget);a.hasClass("disabled")||(e=(t=l.getInsightsData()).storeKey,u.parentalControlsStoreV3.getModelByKey(e).blackList.getValue().length>=l.profileLimit.categoryLength?p.main.showError(_.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.categoryLength)):(n=a.attr("data-url"),e="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.ADD_BLACK+"</h3>",e=(e+="<p>"+l.replaceCharStr(_.su.CHAR.PTCR_V2_OPTIMIZE.ADD_BLACK_MSG,"%NAME",t.profileName)+"</p>")+"<p>"+_.su.escapeHtml(n)+"</p>",p.main.confirm(e,function(){l.changWebBlockStatus(t.ownerId,n,!0,function(){l.setInsightBlock(n),a.addClass("disabled").attr("data-tip",_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCKED),u.parentalControlsStoreV3.load()})},null,_.su.CHAR.PTCR_V2_OPTIMIZE.ADD,null)))}},"#show-more":{ev_button_click:function(){var e,t=l.getInsightsData(),n=t.loadedNum,a=null,a=0<=t.dayIndex?t.data[t.dayIndex].website_list:t.weekSummary.websites;t.loadedNum>=a.length||(n=Math.min(n+5,a.length),e=_(".website-list-wrap").get(0).scrollHeight,u.websiteStore.loadData(a.slice(0,n),!0),t.loadedNum=n,t.loadedNum>=a.length&&o.showMoreBtn.hide(),setTimeout(function(){_(".website-list-wrap").animate({scrollTop:e},1e3)},100))}},"#ptcr-online-devices":{ev_item_select:function(e,t){l.respondSelDev(t,!0);var n,t=u.ptcrOnlineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!0),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())},ev_item_deselect:function(e,t){l.respondDeselDev(t);var n,t=u.ptcrOnlineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())}},"#ptcr-offline-devices":{ev_item_select:function(e,t){l.respondSelDev(t,!1);var n,t=u.ptcrOfflineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!0),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())},ev_item_deselect:function(e,t){l.respondDeselDev(t);var n,t=u.ptcrOfflineDevs.getModelByKey(t);1===t.dev_mark.getValue()&&(n=t.deviceId.getValue(),t=t.name.getValue(),l.examConflictList(t,n,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide())}},"#ptcr-selected-devices => .del-icon":{click:function(e){var e=_(e.target||e.currentTarget).attr("data-mac"),t=u.ptcrSelectedDevs.getModelByKey(e),n=t.online.getValue(),a=t.name.getValue(),t=t.deviceId.getValue();(n?u.ptcrOnlineDevs:u.ptcrOfflineDevs).unselectItems(e),l.respondDeselDev(e),l.examConflictList(a,t,!1),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#url-input":{ev_input_enter:function(){_("#url-input-btn a.button-button").click()}},"#url-input-btn":{ev_button_click:function(){var e,t,n,a=c.ptcrViewModel.url,i=a.getValue();i&&a.validate()&&(t=(e="black"==(e=c.ptcrEditorModel).websiteType.getValue()?e.blackList:e.whiteList).getValue(),!0!==(n=l.validateKeyWeb(i,t))?a.setError(n):(e.setValue(t.concat(i)),a.reset()))}},"#ptcr-grid => a.btn-internet-access":{ev_grid_action_click:function(e,t){var t=u.parentalControlsStoreV3.getModelByKey(t),n=t.ownerId.getValue(),a=t.internetBlocked.getValue(),t=t.name.getValue(),i="",r="",r=a?(i=(i+="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW_TITLE+"</h3>")+"<p>"+l.replaceCharStr(_.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW_MSG,"%name",t)+"</p>",_.su.CHAR.PTCR_V2_OPTIMIZE.ALLOW):(i=(i+="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK_TITLE+"</h3>")+"<p>"+l.replaceCharStr(_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK_MSG,"%name",t)+"</p>",_.su.CHAR.PTCR_V2_OPTIMIZE.BLOCK);p.main.confirm(i,function(){l.toggleProfileStatus(n,!a)},null,r,_.su.CHAR.OPERATION.CANCEL)}},"#ptcr-grid":{ev_grid_edit:function(e,t){"add"===t?(o.parentalCtrlsEditSwitch.setSupportViewSwitch(!1),o.parentalCtrlsAddBtnsLeft.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.CANCEL),o.parentalCtrlsAddBtnsRight.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.NEXT),u.parentalControlsStoreV3.getPlugin("editor").hideBtns(),o.parentalCtrlsAddBtns.show(),o.parentalCtrlsAddBtnsRight.disable(),d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide(),l.loadDeviceList()):(o.parentalCtrlsEditSwitch.setSupportViewSwitch(!0),u.parentalControlsStoreV3.getPlugin("editor").showBtns(),o.parentalCtrlsAddBtns.hide(),o.parentalCtrlsEditSwitch.show(),m.device.getConfig().supportPatrolMark&&1===u.parentalControlsStoreV3.getModelByKey(t).rule_mark.getValue()&&(t=u.parentalControlsStoreV3.getModelByKey(t).viewObjs[0].domId,_("#"+t).find(".pcgrid-red-dot").hide()),_("#edit-name-conflict-hint .closable").click(function(){d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}),_("#add-name-conflict-hint .closable").click(function(){d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}),t=c.ptcrEditorModel.clientList.getValue(),l.loadDeviceList(),l.checkClientList(t)),o.parentalCtrlsEditSwitch.switchField("basic-info")},ev_grid_before_save:function(e,t){return!c.ptcrEditorModel.ownerId.getValue()||l.validateBeforeEditSave(t)},ev_grid_save:function(){l.clearConfirm()},ev_grid_cancel:function(){l.selectedConflictName=[],d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide(),d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#ptcr-grid => a.btn-delete":{ev_grid_action_click:function(e,t){var n=u.parentalControlsStoreV3.getModelByKey(t).name.getValue(),n=l.replaceCharStr(_.su.CHAR.PTCR_V2_OPTIMIZE.DEL_CONFIRM,"%name",n);p.main.confirm(n,function(){l.deleteProfile(t)},null,_.su.CHAR.OPERATION.DELETE,_.su.CHAR.OPERATION.CANCEL)}},"#ptcr-dev-list":{ev_add_item:function(e){l.refreshDeviceList(l.deviceData),l.visibleNoSelDevNote(),o.parentalCtrlsAddDevicesMsg.show(),m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?d.parentalControlsV2OptimizeView.addDeviceConflictHint.show():d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide()}},"#ptcr-dev-list => .del-icon":{click:function(e){for(var t=_(e.target||e.currentTarget).attr("data-id"),n="",a=0;a<l.deviceData.length;a++)if(t==l.deviceData[a].device_id){n=l.deviceData[a].name;break}for(a=0;a<l.allDeviceNameStack[n].length;a++)if(l.allDeviceNameStack[n][a].device_id==t){l.allDeviceNameStack[n][a].selected=!1;break}e=c.ptcrEditorModel.clientList.getValue();l.checkClientList(e)}},"#ptcr-time-list":{ev_add_item:function(){for(var e,t=c.ptcrEditorModel.timeTable.getValue(),n=0,a=t.length,i={};n<a;n++)i[(e=t[n]).whichDay]||(i[e.whichDay]=[]),i[e.whichDay].push(e.range);var i=JSON.stringify(i),r=c.ptcrViewModel.timeTable;r.setValue(i),r.setSnapshot(i),o.ptcrTimeTableMsg.show()}},"#ptcr-add-dev-msg":{ev_msg_ok:function(e,t){t.preventDefault();var n=u.ptcrSelectedDevs,a=n.getSize();if(a>l.profileLimit.devicesLength)r=_.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",l.profileLimit.devicesLength),p.main.showError(r),t.preventDefault();else{for(var i,r,s=0,o="";s<a;s++)""!==(i=n.getModelByIndex(s)).ownerName.getValue()&&(o+="<p>"+_.su.escapeHtml(i.mac.getValue())+" ,"+_.su.escapeHtml(i.name.getValue())+"</p>");0==o.length?l.saveMsgSelDev():(r=c.ptcrEditorModel.name.getValue(),t="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS+"</h3>",t+="<p>"+(r?l.replaceCharStr(_.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS_TIP1,"%name",r):_.su.CHAR.PTCR_V2_OPTIMIZE.MOVE_DEVS_TIP2)+"</p>",p.main.confirm(t="<div class='move-msg-content'>"+(t+=o)+"</div>",l.saveMsgSelDev,null,_.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE)),m.device.getConfig().supportPatrolMark&&0!==l.selectedConflictName.length?(r=_.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),_("#edit-name-conflict-hint").find("span.text").html(r),d.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},ev_msg_no:function(e,t){l.selectedConflictName=[];var n=c.ptcrEditorModel.clientList.getValue();if(0==n.length)d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide();else{for(var a=0;a<l.deviceData.length;a++)l.examConflictList(l.deviceData[a].name,l.deviceData[a].device_id,!1);for(var i,a=0;a<n.length;a++)l.examConflictList(n[a].name,n[a].deviceId,!0);m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?(i=_.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),_("#edit-name-conflict-hint").find("span.text").html(i),d.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},ev_msg_close:function(e,t){var n=c.ptcrEditorModel.clientList.getValue();if(0==n.length)d.parentalControlsV2OptimizeView.addDeviceConflictHint.hide();else{for(var a=0;a<l.deviceData.length;a++)l.examConflictList(l.deviceData[a].name,l.deviceData[a].device_id,!1);for(var i,a=0;a<n.length;a++)l.examConflictList(n[a].name,n[a].deviceId,!0);m.device.getConfig().supportPatrolMark&&0<l.selectedConflictName.length?(i=_.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",l.selectedConflictName.join(" ")),_("#edit-name-conflict-hint").find("span.text").html(i),d.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):d.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}}},"#ptcr-time-table-msg":{ev_msg_ok:function(){var e=c.ptcrViewModel.timeTable.getValue(),e=function(e){var t,n=[];for(t in e)for(var a=0,i=(dayRanges=e[t]).length;a<i;a++)n.push({whichDay:t,range:dayRanges[a]});return n}(JSON.parse(e));c.ptcrEditorModel.timeTable.setValue(e)}},"#parental-ctrls-add-btns-left":{ev_button_click:function(){var e=o.parentalCtrlsEditSwitch,t=e.getCurField(),n=u.parentalControlsStoreV3.getPlugin("editor");"basic-info"==t?(n.getMsgBox().close(),n.cancelEdit()):("filter-level"==t?o.parentalCtrlsAddBtnsLeft.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.CANCEL):o.parentalCtrlsAddBtnsRight.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.NEXT),e.switchPrev())}},"#parental-ctrls-add-btns-right":{ev_button_click:function(){var e=o.parentalCtrlsEditSwitch,t=e.getCurField(),n=u.parentalControlsStoreV3.getPlugin("editor"),a=c.ptcrEditorModel;if("basic-info"==t)o.parentalCtrlsAddBtnsLeft.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.BACK),e.switchNext();else if("filter-level"==t){var t=a.websiteType.getValue(),i=a.whiteList.getValue();"white"!=t||i&&0<i.length?(o.parentalCtrlsAddBtnsRight.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.SAVE),e.switchNext()):(r="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_TITLE+"</h3>",r+="<p>"+_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_NOTE+"</p>",p.main.confirm(r,function(){o.parentalCtrlsAddBtnsRight.setText(_.su.CHAR.PTCR_V2_OPTIMIZE.SAVE),e.switchNext()},null,_.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,_.su.CHAR.OPERATION.CANCEL))}else{var r,t=a.timeTable.getValue(),s=n.getSaveBtn().dom();if(!(t&&0<t.length))return r="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE+"</h3>",r+="<p>"+_.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE_TIP+"</p>",p.main.confirm(r,function(){l.pushConfirm("timetable"),s.triggerHandler("ev_button_click")},l.clearConfirm,_.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,_.su.CHAR.OPERATION.CANCEL),!1;s.triggerHandler("ev_button_click")}}}})}},function(c,a,w,T,o,i){var l,c=this,d=a.parentalControlsV2OptimizeView,r=[],u=[],n={1:"JAN",2:"FEB",3:"MAR",4:"APR",5:"MAY",6:"JUN",7:"JUL",8:"AUG",9:"SEP",10:"OCT",11:"NOV",12:"DEC"},p=[],s=function(e){var t=e%12;return(0==t?12:t)+(1<=e/12&&e/12<2?" PM":" AM")},m=function(e){var t=e.toString();return(1===t.length?"0"+e:t)+":00"};return{profileLimit:{profileLength:16,devicesLength:16,categoryLength:32},allDeviceNameStack:{},selectedConflictName:[],deviceData:[],onTimeChange:function(e,t){var n=i.time.getHour24(),t=i.time.format(t,"yyyy-MM-dd HH:mm:ss",n);d.currentTime.setValue(t)},onHour24Change:function(e,t){c.hourFormatter=t?m:s,w.ptcrViewModel.timeTable.setIs24(t)},replaceCharStr:function(e,t,n){return e.replace(t,_.su.escapeHtml(n))},hourFormatter:s,clearConfirm:function(){p=[]},pushConfirm:function(e){p.push(e)},validateBeforeEditSave:function(e){var t,n=w.ptcrEditorModel,a=n.websiteType.getValue(),i=n.whiteList.getValue(),n=n.timeTable.getValue(),r=T.parentalControlsStoreV3.getPlugin("editor").getSaveBtn().dom(),a=p.indexOf("white")<0&&"white"==a&&!(i&&0<i.length),i=p.indexOf("timetable")<0&&!(n&&0<n.length),s=a&&i;return a?(t="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_TITLE+"</h3>",t+="<p>"+_.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_EMPTY_NOTE+"</p>",o.main.confirm(t,function(e){c.pushConfirm("white"),s&&e.preventDefault(),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},c.clearConfirm,_.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,_.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1):!i||(t="<h3 class='ptcr-confirm-title'>"+_.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE+"</h3>",t+="<p>"+_.su.CHAR.PTCR_V2_OPTIMIZE.NO_TIME_TABLE_TIP+"</p>",o.main.confirm(t,function(){c.pushConfirm("timetable"),setTimeout(function(){r.triggerHandler("ev_button_click")},50)},c.clearConfirm,_.su.CHAR.PTCR_V2_OPTIMIZE.CONTINUE,_.su.CHAR.OPERATION.CANCEL),e.preventDefault(),!1)},getEcharts:function(){var e=_.Deferred();return window.echarts===undefined?_.su.router.loadFile("js/libs/echarts.min.js",function(){e.resolve(window.echarts)}):window.echarts&&e.resolve(window.echarts),e.promise()},initBarChart:function(){var e=d.dayReportXLabel;return e.setField("FIRST",c.hourFormatter(0)),e.setField("SECOND",c.hourFormatter(6)),e.setField("THIRD",c.hourFormatter(12)),e.setField("FOURTH",c.hourFormatter(18)),c.getEcharts().then(function(e){return l||(l=e.init(_("#ptcr-bar-chart").get(0))).setOption({color:["rgba(80,204,215,0.30)"],grid:{show:!0,borderColor:"#BEBEBE",borderWidth:.5,top:30,left:0,right:5,bottom:0,containLabel:!0},xAxis:[{type:"category",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"},splitLine:{show:!0,lineStyle:{type:"dotted"}}}],yAxis:[{type:"value",axisTick:{show:!1},axisLine:{show:!1},axisLabel:{color:"#A7A9AC"}}],series:[{type:"bar",barWidth:"60%",silent:!0}]}),l})},destoryChart:function(){l&&l.clear()},respondSelDev:function(e,t){var n=T.ptcrSelectedDevs,t=(t?T.ptcrOnlineDevs:T.ptcrOfflineDevs).getModelByKey(e).getData(),e=n.getData();n.loadData(e.concat(t)),c.visibleNoSelDevNote()},respondDeselDev:function(e){T.ptcrSelectedDevs.removeDataByKey(e),c.visibleNoSelDevNote()},visibleNoSelDevNote:function(){0<T.ptcrSelectedDevs.getSize()?d.noSelDevNote.hide():d.noSelDevNote.show()},saveMsgSelDev:function(){w.ptcrEditorModel.clientList.setValue(T.ptcrSelectedDevs.getData("submit")),d.parentalCtrlsAddDevicesMsg.close()},validateKeyWeb:function(e,t){var n=c.profileLimit.categoryLength;if(t.length>=n)return _.su.CHAR.PTCR_V2_OPTIMIZE.DEV_CATEGORY_LIMIT.replace("%1$d",n);for(var a=-1,i=0;i<t.length;i++)if(t[i]==e){a=i;break}return!(0<=a)||_.su.CHAR.PTCR_V2_OPTIMIZE.KEYWORD_EXIST},deleteProfile:function(e){T.parentalControlsStoreV3.load({data:{operation:"remove",key:e},success:function(){T.parentalControlsStoreV3.load(),o.main.showNotice(_.su.CHAR.COMMON.SAVED)}})},toggleProfileStatus:function(e,t){i.ajax.request({proxy:"patrolOwnerBlockProxyV3",method:"write",data:{owner_id:e,internet_blocked:t},success:function(){T.parentalControlsStoreV3.load()}})},changWebBlockStatus:function(e,t,n,a){i.ajax.request({url:_.su.url("/admin/smart_network?form=patrol_owner_website_block"),data:{operation:"write",owner_id:e,blocked_status:n,website:t},success:function(e){a&&a(e)}})},setInsightBlock:function(e){for(var t,n,a,i=u.data,r=i.length;r--;)if(a=i[r].website_list,_.isArray(a))for(t=a.length;t--;)(n=a[t]).website===e&&(n.block=!0);for(t=(i=u.weekSummary.websites).length;t--;)(n=i[t]).website===e&&(n.block=!0)},getInsightsData:function(){return u},fetchInsightsData:function(s){var o=_.Deferred(),l=T.parentalControlsStoreV3.getModelByKey(s),d=l.ownerId.getValue();return i.ajax.request({proxy:"ptcrInsightProxyV3",data:{ownerId:d},success:function(e){for(var t=e,n=t.length,a=null;n--;){_.isArray(t[n].website_list)||(t[n].website_list=[]);for(var i,r=(a=t[n].website_list).length;r--;)(i=a[r].website)&&0!=i.length||a.splice(r,1)}u={ownerId:d,profileName:l.name.getValue(),storeKey:s,dayIndex:0,loadedNum:0,webType:l.websiteType.getValue(),data:t,weekSummary:c.calculateSummary(t)},o.resolve(u)},fail:o.reject,error:o.reject}),o},getDAYS:function(){return r},refreshDAYS:function(){r=[];for(var e,t=0,n=i.time.getTime().getTime();t<7;t++)e=new Date(n-864e5*t),r.push({value:t,name:c.convertLocalString(e),day:e.getDay()});return r[0].name=_.su.CHAR.DATE.TODAY,r[1].name=_.su.CHAR.DATE.YESTERDAY,r},convertLocalString:function(e){var t=e.getDate(),e=e.getMonth()+1;return _.su.CHAR.DATEPICKER[n[e]]+" "+t},changeBtnStatus:function(){var e=w.ptcrEditorModel,t=e.ownerId.getValue(),n=e.name.getValue(),e=e.clientList.getValue(),n=n&&n.length||0,n=0<n&&n<=64&&e&&0<e.length,e=T.parentalControlsStoreV3.getPlugin("editor").getSaveBtn();null==t&&(e=d.parentalCtrlsAddBtnsRight),n?e.enable():e.disable()},min2TimeText:function(e){var t;return e<60?e+_.su.CHAR.PTCR_V2_OPTIMIZE.MINS:(t=e%60,parseInt(e/60,10)+_.su.CHAR.PTCR_V2_OPTIMIZE.HOUR+(t?" "+t+_.su.CHAR.PTCR_V2_OPTIMIZE.MINS:""))},calculateSummary:function(e){for(var t,n,a,i=0,r=[],s={},o=[],l=0,d=e.length;l<d;l++)if(t=e[l],i+=n=parseInt(t.spend_online),r.push(n),_.isArray(t.website_list))for(var c,u=t.website_list.length;u--;)(c=t.website_list[u]).spend_online=Number(c.spend_online),s[c.website]?s[c.website].spend_online+=c.spend_online:(c.spend_online=c.spend_online,s[c.website]=_.extend({},c));for(a in s)o.push(s[a]);delete s;for(var p=20;p--;)for(var m,f=o.length;0<--f;)o[f].spend_online>o[f-1].spend_online&&(m=o[f-1],o[f-1]=o[f],o[f]=m);return{total:i,perDay:r.reverse(),websites:o.slice(0,20)}},renderDailyChart:function(e,t,n){d.dayTotal.setField("TIME_ONLINE",c.min2TimeText(e)),n?(d.dayLimit.setField("TIME_LIMIT",n),d.dayLimit.show()):d.dayLimit.hide(),d.dayTotal.show();for(var a=[],i=0;i<24;i++)a.push(i);l.setOption({series:[{data:t}],yAxis:[{max:60,interval:30,axisLabel:{formatter:function(e){return 0===e?"":e+("s"==_.su.widgetSize?_.su.CHAR.PTCR_V2_OPTIMIZE.MINS_SHORT:_.su.CHAR.PTCR_V2_OPTIMIZE.MINS)}},splitLine:{show:!1},splitArea:{show:!0,areaStyle:{color:["rgba(255,255,255,0)","rgba(239,239,239,0.78)"]}}}],xAxis:[{data:a,axisLabel:{show:!1},splitLine:{interval:function(e){return 0!==e&&24!==e&&e%6==0}}}]})},renderHistoryCollection:function(e,t){var n=0,a=[];0===e.length?d.noWebsiteNote.show():(n=(a=e.slice(0,10)).length,u.loadedNum=n,d.noWebsiteNote.hide()),T.websiteStore.loadData(a,!0),T.websiteStore.removeClass("white black").addClass(t),n<e.length?d.showMoreBtn.show():d.showMoreBtn.hide()},renderWeeklyChart:function(){var e=c.getInsightsData().weekSummary.perDay;d.dayLimit.hide(),d.dayTotal.hide();for(var t=e[(s=e.length)-1],n=s-1;n--;)e[n]>t&&(t=e[n]);for(var a=2*Math.ceil(t/60/2)*60,a=Math.max(a,240),i=[],r=c.getDAYS(),s=r.length,o=0;o<s;o++)i.push(r[o].name);l.setOption({series:[{data:e}],yAxis:[{max:a,interval:a/2,axisLabel:{show:!0,formatter:function(e){return 0===e?"":e/60+_.su.CHAR.PTCR_V2_OPTIMIZE.HOUR}}}],xAxis:[{data:i,axisLabel:{show:!0},splitLine:{interval:function(e){return 0!==e&&7!==e}}}]})},examConflictList:function(e,t,n){0<=c.selectedConflictName.indexOf(e)&&c.selectedConflictName.splice(c.selectedConflictName.indexOf(e),1);for(var a=0;a<c.allDeviceNameStack[e].length;a++)t==c.allDeviceNameStack[e][a].device_id?c.allDeviceNameStack[e][a].selected=n:t!==c.allDeviceNameStack[e][a].device_id&&c.allDeviceNameStack[e][a].selected===!n&&c.selectedConflictName.indexOf(e)<0&&c.selectedConflictName.push(e);return!1},checkClientList:function(e){if(!1===i.device.getConfig().supportPatrolMark)a.parentalControlsV2OptimizeView.basicInfoConflictTip.hide();else{c.selectedConflictName=[];for(var t,n=0;n<e.length;n++)c.examConflictList(e[n].name,e[n].deviceId,!0);0<c.selectedConflictName.length?(t=_.su.CHAR.PTCR_V2_OPTIMIZE.NAME_CONFLICT.replace("%name%",c.selectedConflictName.join(" ")),_("#edit-name-conflict-hint").find("span.text").html(t),a.parentalControlsV2OptimizeView.basicInfoConflictTip.show()):a.parentalControlsV2OptimizeView.basicInfoConflictTip.hide()}},loadDeviceList:function(e){c.allDeviceNameStack={},i.ajax.request({proxy:"onlineDevProxyV3",method:"load",ajax:{"async":!1},success:function(e){c.deviceData=e;for(var t=0;t<e.length;t++){var n,a=e[t];c.allDeviceNameStack[a.name]==undefined&&(c.allDeviceNameStack[a.name]=[]),1===a.dev_mark&&(n=_.extend(a,{selected:!1}),c.allDeviceNameStack[a.name].push(n))}}})},refreshDeviceList:function(e){for(var t=T.parentalControlsStoreV3.getData(),n={},a=e.length,i=w.ptcrEditorModel,r=i.ownerId.getValue(),s=0;s<t.length;s++)r!==t[s].ownerId&&(n[t[s].ownerId]=t[s].name);for(var o=0;o<a;o++)n[e[o].owner_id]?e[o]["ownerName"]=n[e[o].owner_id]:e[o]["ownerName"]="";for(var l,d=i.clientList.getValue(),c=[],u=[],p=[],m=0,f=d.length;m<f;m++)l=d[m],c.push(l.mac),n[l.ownerId]?l["ownerName"]=n[l.ownerId]:l["ownerName"]="";for(var _,h=0,v=[],g=[];h<a;h++)"1"==(_=e[h]).online?(v.push(_),0<=c.indexOf(_.mac)&&u.push(_.mac)):(g.push(_),0<=c.indexOf(_.mac)&&p.push(_.mac));T.ptcrOnlineDevs.loadData(v,!0),T.ptcrOfflineDevs.loadData(g,!0),T.ptcrSelectedDevs.loadData(d),T.ptcrOnlineDevs.selectItems(u),T.ptcrOfflineDevs.selectItems(p)}}})}(jQuery),function(o){var l=["sun","mon","tue","wed","thu","fri","sat"];function s(e){for(var t,n,a=0,i=[],r=0,s=(e=o.isArray(e)?e:[]).length;r<s;r++){for(t=e[r][0],n=e[r][1];a<t;)i[a]=0,a++;for(;a<n;)i[a]=1,a++}for(;a<24;)i[a]=0,a++;return i}function d(e){for(var t,n={},a=0,i=l.length;a<i;a++)n[t=l[a]]=function(e){var t,n=[],a=-1;if(e&&24==e.length){for(var i=0,r=!1;i<24;i++)r||1!=e[i]?r&&0==e[i]&&(t=i,n.push([a,t]),r=!1):(r=!0,a=i);r&&n.push([a,24])}return n}(e[t+"_time"]);return n}o.su.define("ptcrStoreProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_list")}),o.su.modelManager.define("ptcrEnableV3",{fields:[{name:"enable"}],proxy:{url:o.su.url("/admin/smart_network?form=patrol_enable")}}),o.su.storeManager.define("parentalControlsStoreV3",{type:"store",fields:[{name:"ownerId",mapping:"owner_id"},{name:"name"},{name:"clientList",mapping:"client_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"internetBlocked",mapping:"internet_blocked"},{name:"whiteList",mapping:"white_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"blackList",mapping:"black_website_list",defaultValue:[],convert:function(e){return e=o.isArray(e)?e:[]}},{name:"websiteType",mapping:"website_type",defaultValue:"black"},{name:"enableWorkdayTimeLimit",mapping:"enable_workday_time_limit",defaultValue:!1},{name:"workdayDailyTime",mapping:"workday_daily_time",defaultValue:"30"},{name:"enableWeekendTimeLimit",mapping:"enable_weekend_time_limit",defaultValue:!1},{name:"weekendDailyTime",mapping:"weekend_daily_time",defaultValue:"30"},{name:"onlineTotal",mapping:"online_total"},{name:"mon_time"},{name:"tue_time"},{name:"wed_time"},{name:"thu_time"},{name:"fri_time"},{name:"sat_time"},{name:"sun_time"},{name:"rule_mark"}],convert:function(e){return(e=o.isArray(e)?e:[]).reverse()},proxy:"ptcrStoreProxyV3"}),o.su.storeManager.define("websiteStore",{type:"store",keyProperty:"website",fields:[{name:"duration",mapping:"spend_online",convert:function(e){var t;return e<60?e+o.su.CHAR.PTCR_V2_OPTIMIZE.MINS:(t=e%60,parseInt(e/60,10)+o.su.CHAR.PTCR_V2_OPTIMIZE.HOUR+(t?" "+t+o.su.CHAR.PTCR_V2_OPTIMIZE.MINS:""))}},{name:"block"}]}),o.su.modelManager.define("ptcrEditorModel",{type:"model",fields:[{name:"ownerId"},{name:"name",maxLength:64,allowBlank:!1},{name:"clientList",convert:function(e){for(var t=0;t<e.length;t++)e[t].deviceId=e[t].device_id,delete e[t].device_id,e[t].ownerId=e[t].owner_id,delete e[t].owner_id,e[t].clientType=e[t].client_type,delete e[t].client_type;return e},serialize:function(e){for(var t=0;t<e.length;t++)e[t].device_id=e[t].deviceId,delete e[t].deviceId,e[t].owner_id=e[t].ownerId,delete e[t].ownerId,e[t].client_type=e[t].clientType,delete e[t].clientType;return e}},{name:"whiteList"},{name:"blackList"},{name:"websiteType"},{name:"enableWorkdayTimeLimit"},{name:"workdayDailyTime"},{name:"enableWeekendTimeLimit"},{name:"weekendDailyTime"},{name:"timeTable"}],convert:function(e){for(var t=d(e),n=0,a=[];n<7;n++)for(var i,r,s=0,o=(r=t[i=l[n]]).length;s<o;s++)a.push({whichDay:i,range:r[s]});return e.timeTable=a,e},serialize:function(e){for(var t,n=e.timeTable,a={},i=0,r=n.length;i<r;i++)a[(t=n[i]).whichDay]?a[t.whichDay].push(t.range):a[t.whichDay]=[t.range];return e.mon_time=s(a.mon),e.tue_time=s(a.tue),e.wed_time=s(a.wed),e.thu_time=s(a.thu),e.fri_time=s(a.fri),e.sat_time=s(a.sat),e.sun_time=s(a.sun),delete e.timeTable,e}}),o.su.storeManager.define("ptcrModeOpts",{type:"store",fields:[{name:"value"},{name:"boxlabel"}],data:[{value:"black",boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.BLACK_LIST},{value:"white",boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.WHITE_LIST}]}),o.su.define("ptcrInsightProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_insights"),readFilter:function(e){return e.data.insights},writeFilter:function(e){return{operation:"read",owner_id:e.ownerId}}}),o.su.storeManager.define("ptcrDayOptionsV3",{type:"store",fields:[{name:"name"},{name:"value"}]}),o.su.modelManager.define("ptcrViewModel",{fields:[{name:"url",maxLength:64,allowBlank:!0,vtype:"string_visible_no_comma"},{name:"timeTable"}]}),o.su.storeManager.define("ptcrOnlineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"},{name:"dev_mark"},{name:"selected",defaultValue:!1}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrOfflineDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"},{name:"dev_mark"}],convert:function(e){return e.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),e}}),o.su.storeManager.define("ptcrSelectedDevs",{type:"store",keyProperty:"mac",fields:[{name:"ownerId",mapping:"owner_id"},{name:"deviceId",mapping:"device_id"},{name:"ip"},{name:"mac"},{name:"name"},{name:"clientType",mapping:"client_type"},{name:"host"},{name:"online",convert:function(e){return"1"==e}},{name:"ownerName"}]}),o.su.storeManager.define("dailyTimeLimitSV3",{type:"store",fields:[{name:"name"},{name:"value"},{name:"boxlabel"}]}),o.su.storeManager.define("ptcrDayWeeks",{type:"store",fields:[{name:"name"},{name:"value"},{name:"selected"},{name:"boxlabel"}],data:[{name:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_DAY,value:"day",selected:!0,boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_DAY},{name:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_WEEK,value:"week",selected:!1,boxlabel:o.su.CHAR.PTCR_V2_OPTIMIZE.PER_WEEK}]}),o.su.define("patrolOwnerBlockProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_owner_block")}),o.su.define("onlineDevProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_devices")}),o.su.define("profileLimitProxyV3",{extend:"IPFProxy",url:o.su.url("/admin/smart_network?form=patrol_limit"),readFilter:function(e){return{profileLength:e.data.profile_len,devicesLength:e.data.devices_len,categoryLength:e.data.category_len}}})}(jQuery),function(o){o.su.moduleManager.define("qosV2",{deps:[],services:["device","time","moduleManager"],models:["qosV2"],stores:["bandwidthUnitStore","qosDevicePriorityStore","timePeriodStore"],views:["qosV2View"],listeners:{ev_on_launch:function(e,i,r,a,s,t,n){r.qosV2View.devicePriorityPanel.hide(),i.supportQosSchedule?(n.time.on("on_time_change",i.onTimeChange),n.time.on("on_hour24_change",i.onHour24Change)):r.qosV2View.scheduleWrap.hide(),a.qosV2.load({success:function(e){"on"==e.enable?r.qosV2View.devicePriorityPanel.show():r.qosV2View.devicePriorityPanel.hide(),i.maxUpBand=parseInt(a.qosV2.maxUpBand.getValue()),i.maxDownBand=parseInt(a.qosV2.maxDownBand.getValue()),"mbps"==e.up_unit&&a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:i.maxUpBand}),"mbps"==e.down_unit&&a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:i.maxDownBand})}}),s.qosDevicePriorityStore.load(),i.initUpdateInterval(),this.listen({"models.qosV2":{ev_model_submit:function(e,t){"on"==t.enable?r.qosV2View.devicePriorityPanel.show():r.qosV2View.devicePriorityPanel.hide()}},"stores.qosDevicePriorityStore":{ev_data_change:function(e,t,n,a){if(t.value!=t.oldValue&&"enablePriority"==n.getName()&&(!0===t.value&&"on"==a.getData().enableLimit?(clearInterval(i.updateInterval),r.qosV2View.qosSpeedLimitConflictMsg.show()):s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})),t.value!=t.oldValue&&"timing"==n.getName()){if(s.qosDevicePriorityStore.abort(),"-2"===t.value)return!1;s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})}}},"views.qosV2View.timeFrom":{ev_value_change:function(e,t){var n=r.qosV2View.timeTo.getValue();i.timeHandler(t,n)}},"views.qosV2View.timeTo":{ev_value_change:function(e,t){var n=r.qosV2View.timeFrom.getValue();i.timeHandler(n,t)}},"models.qosV2.upUnit":{ev_value_change:function(e,t,n){n!=undefined&&null!=n&&0!==i.maxUpBand&&(a.qosV2.upBand.setNormal(),"kbps"==t?a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:1e3}):a.qosV2.upBand.setVtype({vtype:"float_number2",min:1,max:i.maxUpBand}),a.qosV2.upBand.validate())}},"models.qosV2.downUnit":{ev_value_change:function(e,t,n){n!=undefined&&null!=n&&0!==i.maxDownBand&&(a.qosV2.downBand.setNormal(),"kbps"==t?a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:1e3}):a.qosV2.downBand.setVtype({vtype:"float_number2",min:1,max:i.maxDownBand}),a.qosV2.downBand.validate())}}})},ev_before_destroy:function(e,t,n,a,i,r,s){clearInterval(t.updateInterval),t.clearUpdateTime()}},init:function(r,e,t,s,n,a){this.configViews({id:"qosV2View",items:[{id:"qos-device-priority-grid",configs:{popEditor:{editTitle:o.su.CHAR.QOS_V2.SCHEDULE,content:"#qos-schedule-editor",fields:[{name:"timeFrom"},{name:"timeTo"},{name:"repeat"}]},columns:[{dataIndex:"deviceName",cls:"m-hide l-hide xl-hide label-empty"},{text:o.su.CHAR.QOS_V2.TYPE,dataIndex:"deviceType",cls:"m-hide l-hide xl-hide label-empty",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing);(-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n)&&(r='<span class="star-tag"></span>');var o="";switch(t.deviceTag){case"2.4G":o="show_24G";break;case"5G":o="show_5G";break;case"5G_1":o="show_51G";break;case"5G_2":o="show_52G";break;case"wired":o="show_LAN";break;default:o="show_offline"}return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+r+"</span>")+"</div>"+'<div class="device-info-container widget-container">'+'<div class="device-mac-container">'+('<span class="mode '+o+'"></span>')+('<span class="mac">'+t.mac+"</span>")+"</div>"+"</div>"}},{text:o.su.CHAR.QOS_V2.TYPE,width:"12%",dataIndex:"deviceType",cls:"s-hide",renderer:function(e,t){e=e.toLowerCase();var n=t.enablePriority?"enable":"",a="",i="",r="";switch(e){case"pc":a="icon-pc";break;case"phone":a="icon-phone";break;case"pad":a="icon-pad";break;case"entertainment":a="icon-entertainment";break;case"iot_device":a="icon-iot_device";break;case"laptop":a="icon-laptop";break;case"printer":a="icon-printer";break;case"other":a="icon-other";break;default:a="icon-"+e}var s=parseInt(t.timing);return(i+='<div class="device-type-container widget-container">')+('<span class="icon '+a+' ">'+(r=-2===s&&"on"==t.status&&"enable"==n||-2!=s&&"enable"==n?'<span class="star-tag"></span>':r)+"</span>")+"</div>"}},{text:o.su.CHAR.QOS_V2.INFORMATION,width:"25%",dataIndex:"deviceName",cls:"s-hide",renderer:function(e,t){var n="";if("object"===o.type(t)){var a=t.deviceName,i=t.deviceTag,r=t.mac,s=("0.0.0.0"==t.ip||t.ip,"");switch(i){case"2.4G":s="show_24G";break;case"5G":s="show_5G";break;case"5G_1":s="show_51G";break;case"5G_2":s="show_52G";break;case"wired":s="show_LAN";break;default:s="show_offline"}n=(n=(n=(n=n+'<div class="device-info-container widget-container">'+('<div class="name" title="'+a+'">'+a+"</div>"))+"<div>"+('<span class="mode '+s+'"></span>'))+('<span class="mac">'+r+"</span>")+"</div>")+('<div class="edit" deviceName="'+a+'" mac="'+r+'"></div>')+"</div>"}return n}},{text:o.su.CHAR.QOS_V2.REAL_TIME_RATE,width:"20%",dataIndex:"downloadSpeed",renderer:function(e,t){var n,a="",i=function(e){var t=(e=8*parseInt(e,10))/1024<1?(0!==e&&(e=(e/1024).toFixed(2)),o.su.CHAR.NETWORK_MAP.KBPS_BIT):e/1024/1024<1?(e/1024<1e3?e=(e/1024).toFixed(1):e/=1024,o.su.CHAR.NETWORK_MAP.KBPS_BIT):(e=(e/1024/1024).toFixed(1),o.su.CHAR.NETWORK_MAP.MBPS_BIT);return{speed:e,unit:t}};return"object"===o.type(t)&&(n=i(t.downloadSpeed),a=(a=(a=(a=(a+='<div class="speed-upload-container widget-container">')+'<span class="icon"></span><span class="text">'+(t=i(t.uploadSpeed)).speed+"</span>")+'<span class="unit">'+t.unit+'</span></div><div class="speed-download-container widget-container">')+'<span class="icon"></span><span class="text">'+n.speed+"</span>")+'<span class="unit">'+n.unit+"</span></div>"),a}},{text:o.su.CHAR.QOS_V2.TRAFFIC_USAGE,dataIndex:"trafficUsage",cls:"center-td",renderer:function(e,t){if("---"==e)return"---";var n=e,n=t.trafficUsage,e="";n/=1024;for(var a=0;a<4&&1<n/1024;a++)n/=1024;return e=(e+='<span class="text usage">'+Math.floor(10*n)/10+"</span>")+('<span class="text unit">'+["KB","MB","GB","TB"][a]+"</span>")}},{text:o.su.CHAR.QOS_V2.PRIORITY,dataIndex:"enablePriority",xtype:"customWidget",cls:"status connected-clients-grid-priority-td",widgetName:"switch",settings:{trueValue:!0,falseValue:!1}},{text:o.su.CHAR.QOS_V2.TIMING,dataIndex:"timing",xtype:"customWidget",width:98,cls:"s-2-col timing",widgetName:"combobox",settings:{noneSelectedText:"",items:r.timePeriodItem()},showRenderer:!0,renderer:function(e,t){var n,a,i;return t.enablePriority?-2===(n=parseInt(t.timing))?("on"===t.status?o.su.CHAR.TIMESETTING.ON:o.su.CHAR.TIMESETTING.OFF)+'<a href="javascript:void(0)" class="grid-content-btn grid-content-btn-edit btn-edit hidden"><span class="icon"></span></a>':(i=t.remainTime,a=parseInt(i/3600),i=parseInt(i%3600/60),!(!n||t.remainTime<60)&&a+" "+o.su.CHAR.QOS_V2.H+" "+i+" "+o.su.CHAR.QOS_V2.MIN+"</br>"+o.su.CHAR.QOS_V2.REMAINING):"---"}}]}},{id:"qos-schedule-repeat",format:function(e){for(var t=/\b(\w)|\s(\w)/g,n=e.length,a=0;a<n;a++)e[a]=e[a].replace(t,function(e){return e.toUpperCase()});return e.join(",")}}]}),this.control({"#qos-device-priority-grid":{ev_grid_after_save:function(e){r.initUpdateInterval()},ev_grid_cancel:function(e){s.qosDevicePriorityStore.load(),r.initUpdateInterval()},ev_grid_custom_change:function(e,t,n,a,i){e.preventDefault(),"timing"===i.dataIndex&&"-2"===t.value&&t.triggerAction!=undefined&&"clickLabel"==t.triggerAction&&(clearInterval(r.updateInterval),s.qosDevicePriorityStore.abort(),e="#"+n.domId+" .grid-content-btn-edit",o(e).click())}},"#system-time-settings":{ev_button_click:function(){a.moduleManager.get("navigatorController").goTo("timeSettings")}},"#qos-speedlimit-conflict-msg":{ev_msg_ok:function(){s.qosDevicePriorityStore.sync({success:function(e){s.qosDevicePriorityStore.loadData(e,!0)}})},ev_msg_cancel:function(){s.qosDevicePriorityStore.reset()}}})}},function(t,a,e,n,i,r){var s=o("#global-combobox-options");return{updateInterval:null,maxUpBand:0,maxDownBand:0,supportQosSchedule:r.device.getConfig().supportQosSchedule,initUpdateInterval:function(){t.updateInterval=setInterval(function(){"_hidden_"===s.attr("data-shown")&&n.qosDevicePriorityStore.load()},6e3)},timePeriodItem:function(){var e=n.timePeriodStore.getData();return e=t.supportQosSchedule?e.concat([{name:o.su.CHAR.QOS_V2.SCHEDULE,value:"-2"}]):e},onTimeChange:function(e,t){var n=r.time.getHour24(),t=r.time.format(t,"yyyy-MM-dd HH:mm:ss",n);a.qosV2View.currentTime.setValue(t)},onHour24Change:function(e,t){t?(a.qosV2View.timeFrom.setHourSystem("24"),a.qosV2View.timeTo.setHourSystem("24")):(a.qosV2View.timeFrom.setHourSystem("12"),a.qosV2View.timeTo.setHourSystem("12"))},clearUpdateTime:function(){r.time.off("on_time_change",t.onTimeChange),r.time.off("on_hour24_change",t.onHour24Change)},timeHandler:function(e,t){if("string"!=typeof e||"string"!=typeof t)return!1;e=parseInt(e.replace(/:/,""),10),t=parseInt(t.replace(/:/,""),10)<=e?o.su.CHAR.WIRELESS_SCHEDULE.NEXT_DAY_TIP:"";a.qosV2View.timeTo.setShortTips(t)}}})}(jQuery),function(t){t.su.modelManager.define("qosV2",{type:"model",fields:[{name:"enable",defaultValue:"off"},{name:"upBand",mapping:"up_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"downBand",mapping:"down_band",allowBlank:!1,vtype:{vtype:"float_number2",min:1,max:1e3}},{name:"upUnit",mapping:"up_unit"},{name:"downUnit",mapping:"down_unit"},{name:"maxUpBand",mapping:"max_up_band",disabled:!0},{name:"maxDownBand",mapping:"max_down_band",disabled:!0}],proxy:{url:t.su.url("/admin/smart_network?form=qos")}}),t.su.storeManager.define("qosDevicePriorityStore",{type:"store",fields:[{name:"deviceType"},{name:"deviceName"},{name:"deviceTag"},{name:"mac"},{name:"downloadSpeed"},{name:"uploadSpeed"},{name:"trafficUsage"},{name:"enablePriority"},{name:"timePeriod"},{name:"remainTime"},{name:"timeMode",mapping:"time_mode"},{name:"timeFrom",mapping:"time_begin"},{name:"timeTo",mapping:"time_end"},{name:"repeat",mapping:"repeat_weeks",defaultValue:""},{name:"status"},{name:"timing"},{name:"enableLimit"}],convert:function(e){return t.each(e,function(e,t){"schedule"===t.time_mode?t.timing="-2":t.timing=t.timePeriod,t.time_begin||(t.time_begin="10:00",t.time_end="18:00",t.repeat_weeks="Mon,Tue,Wed,Thu,Fri")}),e},serialize:function(e){return t.each(e,function(e,t){"-2"===t.timing?t.time_mode="schedule":(t.time_mode="period",t.timePeriod=t.timing),delete t.timing,delete t.status}),e},proxy:{url:t.su.url("/admin/smart_network?form=device_priority")}})}(jQuery);